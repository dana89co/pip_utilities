<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Diana Garcia">

<title>Group Data Documentation (wbpip)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#structure" id="toc-structure" class="nav-link active" data-scroll-target="#structure">Structure</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions"><span class="header-section-number">1</span> Functions</a>
  <ul class="collapse">
  <li><a href="#sec-pip_stats" id="toc-sec-pip_stats" class="nav-link" data-scroll-target="#sec-pip_stats"><span class="header-section-number">1.1</span> pip_stats</a></li>
  <li><a href="#sec-select_lorenz" id="toc-sec-select_lorenz" class="nav-link" data-scroll-target="#sec-select_lorenz"><span class="header-section-number">1.2</span> select_lorenz</a></li>
  <li><a href="#pip_stats_lq" id="toc-pip_stats_lq" class="nav-link" data-scroll-target="#pip_stats_lq"><span class="header-section-number">1.3</span> pip_stats_lq</a></li>
  <li><a href="#functional_form_lq" id="toc-functional_form_lq" class="nav-link" data-scroll-target="#functional_form_lq"><span class="header-section-number">1.4</span> functional_form_lq</a></li>
  <li><a href="#value_at_lq" id="toc-value_at_lq" class="nav-link" data-scroll-target="#value_at_lq"><span class="header-section-number">1.5</span> value_at_lq</a></li>
  <li><a href="#derive_lq" id="toc-derive_lq" class="nav-link" data-scroll-target="#derive_lq"><span class="header-section-number">1.6</span> derive_lq</a></li>
  <li><a href="#estimate_lq" id="toc-estimate_lq" class="nav-link" data-scroll-target="#estimate_lq"><span class="header-section-number">1.7</span> estimate_lq</a></li>
  <li><a href="#check_curve_validity_lq" id="toc-check_curve_validity_lq" class="nav-link" data-scroll-target="#check_curve_validity_lq"><span class="header-section-number">1.8</span> check_curve_validity_lq</a></li>
  <li><a href="#compute_dist_stats_lq" id="toc-compute_dist_stats_lq" class="nav-link" data-scroll-target="#compute_dist_stats_lq"><span class="header-section-number">1.9</span> compute_dist_stats_lq</a></li>
  <li><a href="#quantile_lq" id="toc-quantile_lq" class="nav-link" data-scroll-target="#quantile_lq"><span class="header-section-number">1.10</span> quantile_lq</a></li>
  <li><a href="#mld_lq" id="toc-mld_lq" class="nav-link" data-scroll-target="#mld_lq"><span class="header-section-number">1.11</span> mld_lq</a></li>
  <li><a href="#gini_lq" id="toc-gini_lq" class="nav-link" data-scroll-target="#gini_lq"><span class="header-section-number">1.12</span> gini_lq</a></li>
  <li><a href="#polarization_lq" id="toc-polarization_lq" class="nav-link" data-scroll-target="#polarization_lq"><span class="header-section-number">1.13</span> polarization_lq</a></li>
  <li><a href="#pip_stats_lb" id="toc-pip_stats_lb" class="nav-link" data-scroll-target="#pip_stats_lb"><span class="header-section-number">1.14</span> pip_stats_lb</a></li>
  <li><a href="#functional_form_lb" id="toc-functional_form_lb" class="nav-link" data-scroll-target="#functional_form_lb"><span class="header-section-number">1.15</span> functional_form_lb</a></li>
  <li><a href="#derive_lb" id="toc-derive_lb" class="nav-link" data-scroll-target="#derive_lb"><span class="header-section-number">1.16</span> derive_lb</a></li>
  <li><a href="#estimate_lb" id="toc-estimate_lb" class="nav-link" data-scroll-target="#estimate_lb"><span class="header-section-number">1.17</span> estimate_lb</a></li>
  <li><a href="#check_curve_validity_lb" id="toc-check_curve_validity_lb" class="nav-link" data-scroll-target="#check_curve_validity_lb"><span class="header-section-number">1.18</span> check_curve_validity_lb</a></li>
  <li><a href="#ddlk" id="toc-ddlk" class="nav-link" data-scroll-target="#ddlk"><span class="header-section-number">1.19</span> DDLK</a></li>
  <li><a href="#compute_poverty_stats_lb" id="toc-compute_poverty_stats_lb" class="nav-link" data-scroll-target="#compute_poverty_stats_lb"><span class="header-section-number">1.20</span> compute_poverty_stats_lb</a></li>
  <li><a href="#compute_headcount_lb" id="toc-compute_headcount_lb" class="nav-link" data-scroll-target="#compute_headcount_lb"><span class="header-section-number">1.21</span> compute_headcount_lb</a></li>
  <li><a href="#betai" id="toc-betai" class="nav-link" data-scroll-target="#betai"><span class="header-section-number">1.22</span> BETAI</a></li>
  <li><a href="#betaicf" id="toc-betaicf" class="nav-link" data-scroll-target="#betaicf"><span class="header-section-number">1.23</span> BETAICF</a></li>
  <li><a href="#gammln" id="toc-gammln" class="nav-link" data-scroll-target="#gammln"><span class="header-section-number">1.24</span> GAMMLN</a></li>
  <li><a href="#rtsafe" id="toc-rtsafe" class="nav-link" data-scroll-target="#rtsafe"><span class="header-section-number">1.25</span> rtSafe</a></li>
  <li><a href="#funcd" id="toc-funcd" class="nav-link" data-scroll-target="#funcd"><span class="header-section-number">1.26</span> funcD</a></li>
  <li><a href="#rtnewt" id="toc-rtnewt" class="nav-link" data-scroll-target="#rtnewt"><span class="header-section-number">1.27</span> rtNewt</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">2</span> References</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="header-section-number">3</span> Appendix</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Group Data Documentation (wbpip)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Diana Garcia </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<h2 id="objective" class="unnumbered anchored">Objective</h2>
<p>This document aims to describe the functions used in <code>wbpip</code> to calculated the poverty and inequality statistics using group data.</p>
</blockquote>
<section id="structure" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="structure">Structure</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart RL
    lz(select_lorenz) --&gt; stats[pip_stats]
    lq(pip_stats_lq) --&gt; lz
    lb(pip_stats_lb) --&gt; lz
    
    form_lq(functional_form_lq) --&gt; lq
    est_lq(estimate_lq) --&gt; lq
    fit_lq(fit_lq) --&gt; lq
    
    form_lb(functional_form_lb) --&gt; lb
    est_lb(estimate_lb) --&gt; lb
    fit_lb(fit_lb) --&gt; lb
    derive_lb(derive_lb) ---&gt; lb
    regres --&gt; lb
    
    check_val(check_curve_validity_lq) --&gt; est_lq
    comp_dist_lq(compute_dist_stats_lq) --&gt; est_lq
    comp_pov_lq(compute_pov_stats_lq) --&gt; est_lq
    
    check_val_lb(check_curve_validity_lb) --&gt; est_lb
    derive_lb(derive_lb) ---&gt; check_val_lb
    ddlk(ddlk) --&gt; check_val_lb
    
    comp_dist_lb(compute_dist_stats_lb) --&gt; est_lb
    derive_lb --&gt; comp_dist_lb
    value_at_lb --&gt; comp_dist_lb
    compute_gini_lb --&gt; comp_dist_lb
    value_at_lb --&gt; compute_gini_lb
    compute_polarization_lb --&gt; comp_dist_lb
    derive_lb --&gt; compute_polarization_lb
    value_at_lb --&gt; compute_polarization_lb
    compute_quantile_lb --&gt; comp_dist_lb
    
    comp_pov_lb(compute_pov_stats_lb) --&gt; est_lb
    compute_headcount_lb --&gt; comp_pov_lb
    rtSafe --&gt; compute_headcount_lb
    funcD --&gt; rtSafe
    rtNewt --&gt; rtSafe
    BETAI --&gt; compute_headcount_lb
    BETAICF --&gt; BETAI
    GAMMLN --&gt; BETAI
    compute_pov_gap_lb --&gt; comp_pov_lb
    compute_pov_severity_lb --&gt; comp_pov_lb
    
    value_at_lb --&gt; fit_lb
    
    polarization_lq(polarization_lq) --&gt; comp_dist_lq
    gini_lq(gini_lq) --&gt; comp_dist_lq
    value_at_lq --&gt; polarization_lq
    value_at_lq(value_at_lq) --&gt; comp_dist_lq
    mld_lq(&lt;b&gt;mld_lq&lt;/b&gt;) --&gt; comp_dist_lq
    quantile_lq(&lt;b&gt;quantile_lq&lt;/b&gt;) --&gt; comp_dist_lq
    derive_lq(derive_lq) --&gt; lq
    derive_lq --&gt; comp_dist_lq
    derive_lq --&gt; mld_lq
    derive_lq --&gt; polarization_lq
    value_at_lq --&gt; quantile_lq
    
    
    style quantile_lq fill:#FFF1A2
    style mld_lq fill:#FFF1A2

</pre>
</div>
</div>
</div>
</div>
</section>
<section id="functions" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="functions"><span class="header-section-number">1</span> Functions</h2>
<section id="sec-pip_stats" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="sec-pip_stats"><span class="header-section-number">1.1</span> pip_stats</h3>
<p><em>Description</em>: Compute poverty statistics for grouped data by selecting the best functional fit for the Lorenz curve (either beta or quadratic)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>gd_compute_pip_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(welfare,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                                 povline,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                                 population,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                                 requested_mean,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">popshare =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">default_ppp =</span> <span class="dv">1</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ppp =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">p0 =</span> <span class="fl">0.5</span>) {</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply Lorenz quadratic fit ----------------------------------------------</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  results_lq <span class="ot">&lt;-</span> <span class="fu">gd_compute_pip_stats_lq</span>(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">welfare =</span> welfare,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> population,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">requested_mean =</span> requested_mean,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">povline =</span> povline,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">popshare =</span> popshare,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">default_ppp =</span> default_ppp,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">ppp =</span> ppp,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">p0 =</span> p0</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply Lorenz beta fit ----------------------------------------------</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  results_lb <span class="ot">&lt;-</span> <span class="fu">gd_compute_pip_stats_lb</span>(</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">welfare =</span> welfare,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> population,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">requested_mean =</span> requested_mean,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">povline =</span> povline,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">popshare =</span> popshare,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">default_ppp =</span> default_ppp,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">ppp =</span> ppp,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">p0 =</span> p0</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply selection rules ---------------------------------------------------</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">gd_select_lorenz</span>(</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">lq =</span> results_lq,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">lb =</span> results_lb</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return only subset of variables</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> out[<span class="fu">c</span>(</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty_line"</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean"</span>,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"median"</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"headcount"</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty_gap"</span>,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty_severity"</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"watts"</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gini"</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mld"</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"polarization"</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"deciles"</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  )]</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="nte-boundary-issue" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Issue: Boundary conditions
</div>
</div>
<div class="callout-body-container callout-body">
<p>At the moment, this is calculated using <span class="math inline">\((\mu L'(0.001) + 4,\mu L'(0.98) - 4)\)</span> (<em>Note: Not sure what is the reason of adding and subtracting 4</em>).</p>
</div>
</div>
</section>
<section id="sec-select_lorenz" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="sec-select_lorenz"><span class="header-section-number">1.2</span> select_lorenz</h3>
<p><em>Description</em>: Select best Lorenz fit and adjust the returned statistics if needed.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>gd_select_lorenz <span class="ot">&lt;-</span> <span class="cf">function</span>(lq, lb) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set default value</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  datamean <span class="ot">&lt;-</span> lq[[<span class="st">"mean"</span>]]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  is_valid <span class="ot">&lt;-</span> lq[[<span class="st">"is_valid"</span>]] <span class="sc">|</span> lb[[<span class="st">"is_valid"</span>]]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  is_normal <span class="ot">&lt;-</span> lq[[<span class="st">"is_normal"</span>]] <span class="sc">|</span> lb[[<span class="st">"is_normal"</span>]]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Selection of Lorenz fit for poverty statistics</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  use_lq_for_pov <span class="ot">&lt;-</span> <span class="fu">use_lq_for_poverty</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">lq =</span> lq,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">lb =</span> lb</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Selection of Lorenz fit for distributional statistics</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  use_lq_for_dist <span class="ot">&lt;-</span> <span class="fu">use_lq_for_distributional</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">lq =</span> lq,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">lb =</span> lb</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retrieve distributional statistics</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  dist <span class="ot">&lt;-</span> <span class="fu">retrieve_distributional</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">lq =</span> lq,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">lb =</span> lb,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid =</span> is_valid,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_lq_for_dist =</span> use_lq_for_dist</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retrieve poverty statistics</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  pov <span class="ot">&lt;-</span> <span class="fu">retrieve_poverty</span>(</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">lq =</span> lq,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">lb =</span> lb,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_normal =</span> is_normal,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_lq_for_pov =</span> use_lq_for_pov</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean             =</span> datamean,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_line     =</span> pov[[<span class="st">"poverty_line"</span>]],</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_min            =</span> dist[[<span class="st">"z_min"</span>]],</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_max            =</span> dist[[<span class="st">"z_max"</span>]],</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ppp            = lq[["ppp"]],</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">gini             =</span> dist[[<span class="st">"gini"</span>]],</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">median           =</span> dist[[<span class="st">"median"</span>]],</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rmed           = rmed,</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmhalf           =</span> dist[[<span class="st">"rmhalf"</span>]],</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">polarization     =</span> dist[[<span class="st">"polarization"</span>]],</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">ris              =</span> dist[[<span class="st">"ris"</span>]],</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">mld              =</span> dist[[<span class="st">"mld"</span>]],</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">dcm              =</span> lq[[<span class="st">"dcm"</span>]],</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">deciles          =</span> dist[[<span class="st">"deciles"</span>]],</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">headcount        =</span> pov[[<span class="st">"headcount"</span>]],</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_gap      =</span> pov[[<span class="st">"poverty_gap"</span>]],</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_severity =</span> pov[[<span class="st">"poverty_severity"</span>]],</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">eh               =</span> pov[[<span class="st">"eh"</span>]],</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">epg              =</span> pov[[<span class="st">"epg"</span>]],</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">ep               =</span> pov[[<span class="st">"ep"</span>]],</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">gh               =</span> pov[[<span class="st">"gh"</span>]],</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">gpg              =</span> pov[[<span class="st">"gpg"</span>]],</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">gp               =</span> pov[[<span class="st">"gp"</span>]],</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">watts            =</span> pov[[<span class="st">"watts"</span>]],</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">sse              =</span> dist[[<span class="st">"sse"</span>]]</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="pip_stats_lq" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="pip_stats_lq"><span class="header-section-number">1.3</span> pip_stats_lq</h3>
<p><em>Description</em>: Compute poverty statistics for grouped data using the quadratic functional form of the Lorenz qurve.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gd_compute_pip_stats_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(welfare,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                                    povline,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                    population,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                    requested_mean,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">popshare =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                    default_ppp,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">ppp =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">p0 =</span> <span class="fl">0.5</span>) {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust mean if different PPP value is provided</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(ppp)) {</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    requested_mean <span class="ot">&lt;-</span> requested_mean <span class="sc">*</span> default_ppp <span class="sc">/</span> ppp</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    ppp <span class="ot">&lt;-</span> default_ppp</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STEP 1: Prep data to fit functional form</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  prepped_data <span class="ot">&lt;-</span> <span class="fu">create_functional_form_lq</span>(</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">welfare =</span> welfare,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> population</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STEP 2: Estimate regression coefficients using LQ parameterization</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  reg_results <span class="ot">&lt;-</span> <span class="fu">regres</span>(prepped_data, <span class="at">is_lq =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  reg_coef <span class="ot">&lt;-</span> reg_results<span class="sc">$</span>coef</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> reg_coef[<span class="dv">1</span>]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> reg_coef[<span class="dv">2</span>]</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> reg_coef[<span class="dv">3</span>]</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 2.1: pre-calculate key values</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  kv <span class="ot">&lt;-</span> <span class="fu">gd_lq_key_values</span>(A, B, C)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OPTIONAL: Only when popshare is supplied</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return poverty line if share of population living in poverty is supplied</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># intead of a poverty line</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(popshare)) {</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    povline <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(popshare,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>                         A, B, C,</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>                         <span class="at">key_values =</span> kv) <span class="sc">*</span> requested_mean</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Boundary conditions (Why 4?)</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  z_min <span class="ot">&lt;-</span> requested_mean <span class="sc">*</span> <span class="fu">derive_lq</span>(<span class="fl">0.001</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>                                      A, B, C,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">key_values =</span> kv) <span class="sc">+</span> <span class="dv">4</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  z_max <span class="ot">&lt;-</span> requested_mean <span class="sc">*</span> <span class="fu">derive_lq</span>(<span class="fl">0.980</span>,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>                                      A, B, C,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">key_values =</span> kv) <span class="sc">-</span> <span class="dv">4</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  z_min <span class="ot">&lt;-</span> <span class="cf">if</span> (z_min <span class="sc">&lt;</span> <span class="dv">0</span>) 0L <span class="cf">else</span> z_min</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  results1 <span class="ot">&lt;-</span> <span class="fu">list</span>(requested_mean, povline, z_min, z_max, ppp)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(results1) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"mean"</span>, <span class="st">"poverty_line"</span>, <span class="st">"z_min"</span>, <span class="st">"z_max"</span>, <span class="st">"ppp"</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STEP 3: Estimate poverty measures based on identified parameters</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  results2 <span class="ot">&lt;-</span> <span class="fu">gd_estimate_lq</span>(requested_mean, povline, p0,</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>                             A, B, C, <span class="at">key_values =</span> kv)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STEP 4: Compute measure of regression fit</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  results_fit <span class="ot">&lt;-</span> <span class="fu">gd_compute_fit_lq</span>(welfare,</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>                                   population,</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>                                   results2<span class="sc">$</span>headcount,</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>                                   A, B, C,</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">key_values =</span> kv)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">c</span>(results1,</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>           results2,</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>           results_fit,</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>           reg_results)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="functional_form_lq" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="functional_form_lq"><span class="header-section-number">1.4</span> functional_form_lq</h3>
<p><em>Description</em>: Prepares data for regression of <span class="math inline">\(y(1-y)\)</span> on <span class="math inline">\((x^2-y)\)</span>, <span class="math inline">\(y(x-1)\)</span> and <span class="math inline">\((x-y)\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>create_functional_form_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(welfare,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                                      population) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CHECK inputs</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assertthat::assert_that(is.numeric(population))</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assertthat::assert_that(is.numeric(welfare))</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assertthat::assert_that(length(population) == length(welfare))</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assertthat::assert_that(length(population) &gt; 1)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove last observation (the functional form for the Lorenz curve already forces</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># it to pass through the point (1, 1)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  nobs <span class="ot">&lt;-</span> <span class="fu">length</span>(population) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  population <span class="ot">&lt;-</span> population[<span class="dv">1</span><span class="sc">:</span>nobs]</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  welfare <span class="ot">&lt;-</span> welfare[<span class="dv">1</span><span class="sc">:</span>nobs]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># L(1-L)</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> welfare <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> welfare)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (P^2-L)</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> population<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> welfare</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># L(P-1)</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> welfare <span class="sc">*</span> (population <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># P-L</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  x3 <span class="ot">&lt;-</span> population <span class="sc">-</span> welfare</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">y =</span> y, <span class="at">X =</span> <span class="fu">cbind</span>(x1, x2, x3)))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Note</em>: The last observation of (x,y), which by construction has the value (1, 1), is excluded since the functional form for the Lorenz curve already forces it to pass through the point (1, 1).</p>
<p><em>References</em>: [1]</p>
<p><em>Relevant equations</em>:</p>
<p>The general Quadratic Lorenz curve form is:</p>
<p><span id="eq-gen-equation"><span class="math display">\[ax^2 + bxy + cy^2 + dx + ey + f = 0 \tag{1}\]</span></span></p>
<p>where <span class="math inline">\(y\)</span> is the vector of cumulative proportion of consumption/income (L) and <span class="math inline">\(x\)</span> is the cumulative proportions of population (P). Using the conditions <span class="math inline">\(f=0\)</span> and <span class="math inline">\(e = -(a+b+d+1)\)</span> the previous equation is rewritten in a linear form as follows (Equation 15 in Villasenor et al, 1989):</p>
<p><span id="eq-linear-form"><span class="math display">\[y(1-y) = a(x^2-y) + by(x-1) + d(x-y) \tag{2}\]</span></span></p>
<p>This function prepares data to estimate <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(d\)</span> (<em>Note</em>: <span class="math inline">\(d\)</span> is named <span class="math inline">\(C\)</span> in <code>wbpip</code>).</p>
</section>
<section id="value_at_lq" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="value_at_lq"><span class="header-section-number">1.5</span> value_at_lq</h3>
<p><em>Description</em>: Solves for the Quadratic Lorenz curves.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>value_at_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(x, A, B, C, key_values) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for NA, Inf and negative values in x</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_NA_Inf_values</span>(x)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_neg_values</span>(x)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculations</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e &lt;- -(A + B + C + 1)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># m &lt;- (B^2) - (4 * A)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n &lt;- (2 * B * e) - (4 * C)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> (key_values<span class="sc">$</span>m <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (key_values<span class="sc">$</span>n <span class="sc">*</span> x) <span class="sc">+</span> (key_values<span class="sc">$</span>e<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  temp[temp <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Solving the equation of the Lorenz curve</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  estle <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> ((B <span class="sc">*</span> x) <span class="sc">+</span> key_values<span class="sc">$</span>e <span class="sc">+</span> <span class="fu">sqrt</span>(temp))</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(estle)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em>: [1]</p>
<p><em>Relevant equations</em>:</p>
<p>This function calculates the value at the Quadratic Lorenz Curve. Solving <a href="#eq-gen-equation">Equation&nbsp;1</a> for <span class="math inline">\(y\)</span>, and assuming <span class="math inline">\(f=0\)</span> and <span class="math inline">\(e = -(a+b+d+1)\)</span> the density function that better fits income distributions will be (Equation 6b in Villasenor et al, 1989):</p>
<p><span id="eq-solve-y"><span class="math display">\[ y= \Bigl\{-(bx+e) - (\alpha x^2 + \beta x + e^2)^\frac{1}{2}\Bigl\}/2 \tag{3}\]</span></span></p>
<p>where <span class="math inline">\(\alpha = b^2 -4a\)</span> and <span class="math inline">\(\beta = 2be - 4d\)</span>.</p>
</section>
<section id="derive_lq" class="level3" data-number="1.6">
<h3 data-number="1.6" class="anchored" data-anchor-id="derive_lq"><span class="header-section-number">1.6</span> derive_lq</h3>
<p><em>Description</em>: returns the first derivative of the quadratic Lorenz curves with <span class="math inline">\(c = 1\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>derive_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(x, A, B, C, key_values) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(key_values)) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    key_values <span class="ot">&lt;-</span> <span class="fu">gd_lq_key_values</span>(A, B, C)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># e          &lt;- key_values$e</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># m          &lt;- key_values$m</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># n          &lt;- key_values$n</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">anyNA</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    cli<span class="sc">::</span><span class="fu">cli_abort</span>(<span class="st">"`x' must be a numeric or integer vector"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note:</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   alpha --&gt; m</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   beta  --&gt; n</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e &lt;- -(A + B + C + 1)</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># m &lt;- (B^2) - (4 * A)</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n &lt;- (2 * B * e) - (4 * C) # C is called D in original paper, but C in Datt paper</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> (key_values<span class="sc">$</span>m <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (key_values<span class="sc">$</span>n <span class="sc">*</span> x) <span class="sc">+</span> (key_values<span class="sc">$</span>e<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  tmp[(<span class="sc">!</span><span class="fu">is.na</span>(tmp) <span class="sc">&amp;</span> tmp <span class="sc">&lt;</span> <span class="dv">0</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># If tmp == 0, val = Inf.</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Formula for first derivative of GQ Lorenz Curve</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;-</span> <span class="sc">-</span>(B <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> ((<span class="dv">2</span> <span class="sc">*</span> key_values<span class="sc">$</span>m <span class="sc">*</span> x <span class="sc">+</span> key_values<span class="sc">$</span>n) <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> <span class="fu">sqrt</span>(tmp)))</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(val)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em>: [1]</p>
<p><em>Relevant equations</em>:</p>
<p>This function computes the first derivative of <a href="#eq-solve-y">Equation&nbsp;3</a>:</p>
<p><span id="eq-first-der"><span class="math display">\[-(b / 2) - (\beta + 2 \alpha x) / (4\sqrt(\alpha x^2 + \beta x + e^2) \tag{4}\]</span></span></p>
</section>
<section id="estimate_lq" class="level3" data-number="1.7">
<h3 data-number="1.7" class="anchored" data-anchor-id="estimate_lq"><span class="header-section-number">1.7</span> estimate_lq</h3>
<p><em>Description</em>: Estimates poverty and inequality stats from Quadratic Lorenz fit</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>gd_estimate_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(mean, povline, p0, A, B, C, key_values) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(key_values)) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    key_values <span class="ot">&lt;-</span> <span class="fu">gd_lq_key_values</span>(A, B, C)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  e  <span class="ot">&lt;-</span> key_values<span class="sc">$</span>e</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  m  <span class="ot">&lt;-</span> key_values<span class="sc">$</span>m</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  n  <span class="ot">&lt;-</span> key_values<span class="sc">$</span>n</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  r  <span class="ot">&lt;-</span> key_values<span class="sc">$</span>r</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  s1 <span class="ot">&lt;-</span> key_values<span class="sc">$</span>s1</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  s2 <span class="ot">&lt;-</span> key_values<span class="sc">$</span>s2</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  validity <span class="ot">&lt;-</span> <span class="fu">check_curve_validity_lq</span>(A, B, C, <span class="at">key_values =</span> key_values)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                                      <span class="co">#e, m, n, r^2)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (validity<span class="sc">$</span>is_valid <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> validity<span class="sc">$</span>is_normal <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(empty_gd_compute_pip_stats_response)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute distributional measures -----------------------------------------</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  dist_stats <span class="ot">&lt;-</span> <span class="fu">gd_compute_dist_stats_lq</span>(mean, p0, A, B, C, <span class="at">key_values =</span> key_values)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute poverty stats ---------------------------------------------------</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  pov_stats  <span class="ot">&lt;-</span> <span class="fu">gd_compute_poverty_stats_lq</span>(mean, povline, A, B, C, <span class="at">key_values =</span> key_values)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">gini =</span> dist_stats<span class="sc">$</span>gini,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> dist_stats<span class="sc">$</span>median,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmhalf =</span> dist_stats<span class="sc">$</span>rmhalf,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">polarization =</span> dist_stats<span class="sc">$</span>polarization,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">ris =</span> dist_stats<span class="sc">$</span>ris,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">mld =</span> dist_stats<span class="sc">$</span>mld,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">dcm =</span> dist_stats<span class="sc">$</span>dcm,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">deciles =</span> dist_stats<span class="sc">$</span>deciles,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">headcount =</span> pov_stats<span class="sc">$</span>headcount,</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_gap =</span> pov_stats<span class="sc">$</span>pg,</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_severity =</span> pov_stats<span class="sc">$</span>p2,</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">eh =</span> pov_stats<span class="sc">$</span>eh,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">epg =</span> pov_stats<span class="sc">$</span>epg,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">ep =</span> pov_stats<span class="sc">$</span>ep,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">gh =</span> pov_stats<span class="sc">$</span>gh,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">gpg =</span> pov_stats<span class="sc">$</span>gpg,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">gp =</span> pov_stats<span class="sc">$</span>gp,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">watts =</span> pov_stats<span class="sc">$</span>watts,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">dl =</span> pov_stats<span class="sc">$</span>dl,</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">ddl =</span> pov_stats<span class="sc">$</span>ddl,</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_normal =</span> validity<span class="sc">$</span>is_normal,</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid =</span> validity<span class="sc">$</span>is_valid</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="check_curve_validity_lq" class="level3" data-number="1.8">
<h3 data-number="1.8" class="anchored" data-anchor-id="check_curve_validity_lq"><span class="header-section-number">1.8</span> check_curve_validity_lq</h3>
<p><em>Description</em>: Check validity of Lorenz Quadratic fit</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>check_curve_validity_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C, key_values) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  is_normal <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  is_valid <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> (key_values<span class="sc">$</span>r)<span class="sc">^</span><span class="dv">2</span> <span class="co"># formerly, the input to the func was r^2</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># r needs to be &gt; 0 because need to extract sq root</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (r <span class="sc">&lt;</span> <span class="dv">0</span>) { <span class="co"># now that r is squared, this will never be TRUE</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>( <span class="co"># but r^2 was used as input before `key_values` so</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_normal =</span> is_normal, <span class="co"># this was already never executed</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_valid =</span> is_valid</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (key_values<span class="sc">$</span>e <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">||</span> C <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_normal =</span> is_normal,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_valid =</span> is_valid</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Failure conditions for checking theoretically valid Lorenz curve</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Found in section 4 of Datt computational tools paper</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  cn1 <span class="ot">&lt;-</span> key_values<span class="sc">$</span>n<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  cn3 <span class="ot">&lt;-</span> cn1 <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> key_values<span class="sc">$</span>e<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>((key_values<span class="sc">$</span>m <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">|</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    ((key_values<span class="sc">$</span>m <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">&amp;</span> (key_values<span class="sc">$</span>m <span class="sc">&lt;</span> cn3) <span class="sc">&amp;</span> (key_values<span class="sc">$</span>n <span class="sc">&gt;=</span> <span class="dv">0</span>)) <span class="sc">|</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    ((key_values<span class="sc">$</span>m <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">&amp;</span> (key_values<span class="sc">$</span>m <span class="sc">&lt;</span> <span class="sc">-</span>key_values<span class="sc">$</span>n <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">&amp;</span> (key_values<span class="sc">$</span>m <span class="sc">&lt;</span> cn3)))) {</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_normal =</span> is_normal,</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_valid =</span> is_valid</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  is_normal <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  is_valid <span class="ot">&lt;-</span> (A <span class="sc">+</span> C) <span class="sc">&gt;=</span> <span class="fl">0.9</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_normal =</span> is_normal,</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid  =</span> is_valid</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em>: [1], [2], [3]</p>
<p><em>Relevant equations</em>:</p>
<p>The function tests for specific assumptions for the Lorenz Quadratic and relies on the formulas from Table 2 in Datt, G (1998) [3]. The nomenclature for some of these formulas differ from Villasenor et al (1989), so this is how they match:</p>
<p><span class="math inline">\(m = \alpha = b^2 -4a\)</span></p>
<p><span class="math inline">\(n = \beta = 2be -4c\)</span> (<span class="math inline">\(c=d\)</span> for Villasenor et al, 1989)</p>
<p><span class="math inline">\(r = K*2\alpha = (n^2 - 4me^2)^\frac{1}{2}\)</span></p>
<div id="nte-cond-r-issue" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Issue: Rename <span class="math inline">\(r\)</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>At the moment, <span class="math inline">\(r\)</span> refers to <span class="math inline">\((n^2 - 4me^2)\)</span> in <code>wbpip</code>. This is already fixed on commit <code>47852c</code> in branch <code>fix_key_values</code> by Zander (Waiting for merge). We should maybe rename this within this function.</p>
</div>
</div>
<p>The conditions this function tests are presented in Section 4 of Datt (1998):</p>
<p>Normality and Validity</p>
<ul>
<li><span class="math inline">\((n^2 - 4me^2)&gt;0\)</span> so the square root in <span class="math inline">\(r\)</span> to be positive. (Normality and validity)</li>
<li><span class="math inline">\(e&lt;0\)</span> or <span class="math inline">\(c&gt;0\)</span> so <span class="math inline">\(L(0,y) = 0\)</span> and <span class="math inline">\(L'(0^{+},y) \geq 0\)</span> (Normality and validity)</li>
<li><span class="math inline">\(a+d \geq 0.9\)</span> so <span class="math inline">\(L(1,y) = 1\)</span> (Validity)</li>
</ul>
<div id="imp-condad" class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Issue: The inequality for <span class="math inline">\(a+d\)</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>At the moment, most test are design for the old validation <span class="math inline">\(a+d \leq 1\)</span>. However, the Corrigendum of the original paper [2] indicates we should use <span class="math inline">\(a+d \geq 1\)</span></p>
</div>
</div>
<p>And so <span class="math inline">\(L''(x,y) \geq 0\)</span> for <span class="math inline">\(x\)</span> within <span class="math inline">\((0,1)\)</span>:</p>
<ul>
<li><span class="math inline">\(m &lt; 0\)</span> (condition on Villasenor et al., 1989)</li>
<li>if <span class="math inline">\(m &gt; 0\)</span> then <span class="math inline">\(m &lt; n^2/4 e^2\)</span> and <span class="math inline">\(n \leq 0\)</span> (last condition from Datt,1998)</li>
<li>if <span class="math inline">\(m &gt; 0\)</span> then <span class="math inline">\(m &lt; n^2/4 e^2\)</span> and <span class="math inline">\(m &lt; -n/2\)</span> (last condition from Datt,1998)</li>
</ul>
<p><span class="math inline">\(L''(x,y)\)</span> can be calculated using <a href="#eq-first-der">Equation&nbsp;4</a>:</p>
<p><span class="math display">\[ \frac{\beta^2 -4\alpha e^2}{8(\alpha x^2 + \beta x + e^2)^\frac{3}{2}} = \frac{n^2 - 4me^2}{8(mx^2 +nx +e^2)^\frac{3}{2}}=\frac{r^2}{8(mx^2 +nx +e^2)^\frac{3}{2}} \]</span></p>
</section>
<section id="compute_dist_stats_lq" class="level3" data-number="1.9">
<h3 data-number="1.9" class="anchored" data-anchor-id="compute_dist_stats_lq"><span class="header-section-number">1.9</span> compute_dist_stats_lq</h3>
<p><em>Description</em>: Computes distributional stats from Lorenz Quadratic fit</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>gd_compute_dist_stats_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(mean, p0, A, B, C, <span class="at">key_values =</span> key_values) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  gini    <span class="ot">&lt;-</span> <span class="fu">gd_compute_gini_lq</span>(A, B, C,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">key_values =</span> key_values)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  median  <span class="ot">&lt;-</span> mean <span class="sc">*</span> <span class="fu">derive_lq</span>(<span class="fl">0.5</span>, A, B, C,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">key_values =</span> key_values)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  rmhalf  <span class="ot">&lt;-</span> <span class="fu">value_at_lq</span>(p0, A, B, C,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">key_values =</span> key_values) <span class="sc">*</span> mean <span class="sc">/</span> p0 <span class="co"># What is this??</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  dcm     <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> gini) <span class="sc">*</span> mean</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  pol     <span class="ot">&lt;-</span> <span class="fu">gd_compute_polarization_lq</span>(mean, p0, dcm, A, B, C,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">key_values =</span> key_values)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  ris     <span class="ot">&lt;-</span> <span class="fu">value_at_lq</span>(<span class="fl">0.5</span>, A, B, C,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">key_values =</span> key_values)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  mld     <span class="ot">&lt;-</span> <span class="fu">gd_compute_mld_lq</span>(A, B, C,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                               <span class="at">key_values =</span> key_values)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  deciles <span class="ot">&lt;-</span> <span class="fu">gd_compute_quantile_lq</span>(A, B, C,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">key_values =</span> key_values)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">gini         =</span> gini,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">median       =</span> median,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmhalf       =</span> rmhalf,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">dcm          =</span> dcm,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">polarization =</span> pol,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">ris          =</span> ris,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">mld          =</span> mld,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">deciles      =</span> deciles</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="nte-check1" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check:
</div>
</div>
<div class="callout-body-container callout-body">
<p>What is the difference with <code>gd_estimate_dist_stats_lq</code>?</p>
</div>
</div>
</section>
<section id="quantile_lq" class="level3" data-number="1.10">
<h3 data-number="1.10" class="anchored" data-anchor-id="quantile_lq"><span class="header-section-number">1.10</span> quantile_lq</h3>
<p><em>Description</em>: Compute quantiles from Lorenz Quandratic fit</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>old_gd_compute_quantile_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C, <span class="at">n_quantile =</span> <span class="dv">10</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> n_quantile)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> n_quantile</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> 0L</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  lastq <span class="ot">&lt;-</span> 0L</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n_quantile <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    q <span class="ot">&lt;-</span> <span class="fu">value_at_lq</span>(x1, A, B, C)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">&lt;-</span> q <span class="sc">-</span> lastq</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    vec[i] <span class="ot">&lt;-</span> v</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    lastq <span class="ot">&lt;-</span> q</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    x1 <span class="ot">&lt;-</span> x1 <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> n_quantile</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  vec[n_quantile] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> lastq</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vec)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Note</em>: This function calculates the quantiles for a Lorenz Quadratic with specific values for <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span> and <span class="math inline">\(d\)</span>.</p>
<div id="imp-quant-gd-issue" class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Issues:
</div>
</div>
<div class="callout-body-container callout-body">
<p>The description of this function indicates that it calculates the quantiles (deciles) for the density for some specific values of <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span> and <span class="math inline">\(d\)</span>, but it calculates instead the share or the value between the deciles. If I understand correctly, the density is the lorenz curve and the share will refer to the <code>deciles</code> of the welfare vector.</p>
<p>Regarding the last decile, they manually calculated it by subtracting 1 to the second-to-last decile:</p>
<p><code>vec[n_quantile] &lt;- 1 - value_at_lq(x[n_quantile-1], A, B, C)</code> where <code>n_quantile = 10</code></p>
<p>However, my hypothesis is that this is related to <em>Issue: The inequality for</em> <span class="math inline">\(a+d\)</span> above. If <span class="math inline">\(A+C \geq 1\)</span> then <code>value_at_lq(1, A, B, C) = 1</code>. We can see the case in this <a href="https://www.desmos.com/calculator/g164gdepzk" class="external" target="_blank">Desmos graph</a>.</p>
</div>
</div>
<p><em>My version of the code</em>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>gd_compute_quantile_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C, <span class="at">n_quantile =</span> <span class="dv">10</span>) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  x   <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span><span class="sc">/</span>n_quantile, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span><span class="sc">/</span>n_quantile)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">value_at_lq</span>(x, A, B, C)))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  vec[n_quantile] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> <span class="fu">value_at_lq</span>(x[n_quantile<span class="dv">-1</span>], A, B, C) <span class="co"># Is this correct?</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vec)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mld_lq" class="level3" data-number="1.11">
<h3 data-number="1.11" class="anchored" data-anchor-id="mld_lq"><span class="header-section-number">1.11</span> mld_lq</h3>
<p><em>Description</em>: Computes Mean Log Deviation from Lorenz Quadratic fit</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>old_gd_compute_mld_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(<span class="fl">0.0005</span>, A, B, C)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  gap <span class="ot">&lt;-</span> 0L</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  mld <span class="ot">&lt;-</span> 0L</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x1 <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    gap <span class="ot">&lt;-</span> <span class="fl">0.0005</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    mld <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">log</span>(x1) <span class="sc">*</span> <span class="fl">0.001</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(<span class="dv">0</span>, A, B, C)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (xstep <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.998</span>, <span class="fl">0.001</span>)) {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    x2 <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(xstep <span class="sc">+</span> <span class="fl">0.001</span>, A, B, C)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((x1 <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="sc">||</span> (x2 <span class="sc">&lt;=</span> <span class="dv">0</span>)) {</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      gap <span class="ot">&lt;-</span> gap <span class="sc">+</span> <span class="fl">0.001</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (gap <span class="sc">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      gap <span class="ot">&lt;-</span> 0L</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>      mld <span class="ot">&lt;-</span> mld <span class="sc">+</span> (<span class="fu">log</span>(x1) <span class="sc">+</span> <span class="fu">log</span>(x2)) <span class="sc">*</span> <span class="fl">0.0005</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x1 <span class="ot">&lt;-</span> x2</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span>mld)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em>: None</p>
<p><em>Note</em>: In this function, they do not describe how the function is calculated. The following is my hypothesis of what they were trying to accomplish:</p>
<p><em>Relevant equations</em>:</p>
<p>The mean log deviation:</p>
<p><span class="math display">\[-\frac{1}{N} \sum_{i=1}^N ln(\frac{y_i}{\mu})=-\frac{1}{N} \sum_{i=1}^N ln(\frac{y_i}{\frac{1}{N}\sum_{i=1}^N y_i}) \]</span></p>
<p>Using the derivation from Rohde (2008) (Equation 15.20), we know that:</p>
<p><span class="math display">\[L'(\pi) = \frac{N y_k}{\sum_{k=1}^N y_k}\]</span></p>
<p>where <span class="math inline">\(y_k\)</span> is the income accruing to the <span class="math inline">\(k_{th}\)</span> individual if ordered such that <span class="math inline">\(y_1&lt;y_2&lt;...&lt;y_k\)</span> and <span class="math inline">\(\pi= \frac{k}{j}\)</span>. Then the mean log deviation can be rewritten as (Equation 15.21):</p>
<p><span class="math display">\[-\int_0^1 ln(L'(\pi))d\pi= \lim_{n \rightarrow \infty} -\sum_{i=1}^{N}\frac{1}{N}ln(\frac{N y_k}{\sum_{k=1}^N y_k})\]</span></p>
<div id="imp-mld-gd-issue" class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Issue:
</div>
</div>
<div class="callout-body-container callout-body">
<p>My hypothesis is that they used the last formula to calculate the Mean Log Deviation. I am still unsure why they used some rules at the lower end, more specifically why they return <span class="math inline">\(1\)</span> if for the left tail of <span class="math inline">\(y\)</span> we encounter negative values.</p>
</div>
</div>
<p><em>My version of the code</em>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>gd_compute_mld_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(<span class="fl">0.0005</span>, A, B, C) </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  mld <span class="ot">&lt;-</span> 0L</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x1 <span class="sc">!=</span> <span class="dv">0</span>) { </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    mld <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">log</span>(x1) <span class="sc">*</span> <span class="fl">0.001</span>) <span class="co"># Needed to match test</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  xstep <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.999</span>, <span class="fl">0.001</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(xstep, A, B, C)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">33</span>]<span class="sc">&lt;=</span><span class="dv">0</span>)){ <span class="co"># To account for negative values </span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    mld <span class="ot">&lt;-</span> mld <span class="sc">+</span> <span class="fu">fsum</span>( (<span class="fu">log</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])<span class="sc">+</span><span class="fu">log</span>(x[<span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>])) <span class="sc">*</span><span class="fl">0.0005</span>) </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="sc">-</span>mld)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="gini_lq" class="level3" data-number="1.12">
<h3 data-number="1.12" class="anchored" data-anchor-id="gini_lq"><span class="header-section-number">1.12</span> gini_lq</h3>
<p><em>Description</em>: Compute Gini index from Lorenz Quadratic fit.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>gd_compute_gini_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C, key_values) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For the GQ Lorenz curve, the Gini formula are valid under the condition A+C&gt;=1</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># P.isValid &lt;- (A + C) &gt;= 0.9</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># P.isNormal &lt;- TRUE</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  e1 <span class="ot">&lt;-</span> <span class="fu">abs</span>(A <span class="sc">+</span> C <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  e2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> (B <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">+</span> key_values<span class="sc">$</span>e</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  tmp1 <span class="ot">&lt;-</span> key_values<span class="sc">$</span>n <span class="sc">*</span> (B <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> key_values<span class="sc">$</span>m)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> (key_values<span class="sc">$</span>r<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">8</span> <span class="sc">*</span> key_values<span class="sc">$</span>m)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  tmp3 <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> key_values<span class="sc">$</span>m) <span class="sc">+</span> key_values<span class="sc">$</span>n</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (key_values<span class="sc">$</span>m <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tmpnum &lt;- tmp3 + 2 * sqrt(m) * abs(e)</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tmpden &lt;- n - 2 * abs(e) * sqrt(m)</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Formula from Datt paper</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CHECK that code matches formulas in paper</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    gini <span class="ot">&lt;-</span> e2 <span class="sc">+</span> (tmp3 <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> key_values<span class="sc">$</span>m)) <span class="sc">*</span> e1 <span class="sc">-</span> (key_values<span class="sc">$</span>n <span class="sc">*</span> <span class="fu">abs</span>(key_values<span class="sc">$</span>e) <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> key_values<span class="sc">$</span>m)) <span class="sc">-</span> ((key_values<span class="sc">$</span>r<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">8</span> <span class="sc">*</span> <span class="fu">sqrt</span>(key_values<span class="sc">$</span>m)<span class="sc">^</span><span class="dv">3</span>)) <span class="sc">*</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(<span class="fu">abs</span>(((tmp3 <span class="sc">+</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(key_values<span class="sc">$</span>m) <span class="sc">*</span> e1))) <span class="sc">/</span> (key_values<span class="sc">$</span>n <span class="sc">+</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(key_values<span class="sc">$</span>m) <span class="sc">*</span> <span class="fu">abs</span>(key_values<span class="sc">$</span>e)))))</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># P.gi &lt;- (e/2) - tmp1 - (tmp2 * log(abs(tmpnum/tmpden)) / sqrt(m))</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    tmp4 <span class="ot">&lt;-</span> ((<span class="dv">2</span> <span class="sc">*</span> key_values<span class="sc">$</span>m) <span class="sc">+</span> key_values<span class="sc">$</span>n) <span class="sc">/</span> key_values<span class="sc">$</span>r</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    tmp4 <span class="ot">&lt;-</span> <span class="cf">if</span> (tmp4 <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">-</span><span class="dv">1</span> <span class="cf">else</span> tmp4</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    tmp4 <span class="ot">&lt;-</span> <span class="cf">if</span> (tmp4 <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="dv">1</span> <span class="cf">else</span> tmp4</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Formula does not match with paper</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    gini <span class="ot">&lt;-</span> e2 <span class="sc">+</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>      (tmp3 <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> key_values<span class="sc">$</span>m)) <span class="sc">*</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>      e1 <span class="sc">-</span> (key_values<span class="sc">$</span>n <span class="sc">*</span> <span class="fu">abs</span>(key_values<span class="sc">$</span>e) <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> key_values<span class="sc">$</span>m)) <span class="sc">+</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>      (tmp2 <span class="sc">*</span> (<span class="fu">asin</span>(tmp4) <span class="sc">-</span> <span class="fu">asin</span>(key_values<span class="sc">$</span>n <span class="sc">/</span> key_values<span class="sc">$</span>r)) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="sc">-</span>key_values<span class="sc">$</span>m))</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># P.gi &lt;- (e/2) - tmp1 + ((tmp2 * (asin(tmp4) - asin(n/r))) / sqrt(-m))</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gini)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em>: [3]</p>
<p><em>Relevant equations</em>:</p>
<ul>
<li>if <span class="math inline">\(m&lt;0\)</span>:</li>
</ul>
<p><span class="math display">\[ \frac{e}{2} - \frac{n (b+2)}{4m} + \frac{r^2}{8m\sqrt{-m}}\left[ \sin^{-1} \frac{2 + n}{r} - \sin^{-1} \frac{2 + n}{r} \right]\]</span></p>
<ul>
<li>if <span class="math inline">\(m&gt;0\)</span>:</li>
</ul>
<p><span class="math display">\[  \frac{e}{2} - \frac{n (b+2)}{4m} - \frac{r^2}{8m\sqrt{m}} \ln \left[\left|{\frac{2m+n+2\sqrt{m} (a+c-1)}{n-2e\sqrt{m}}}\right| \right] \]</span></p>
</section>
<section id="polarization_lq" class="level3" data-number="1.13">
<h3 data-number="1.13" class="anchored" data-anchor-id="polarization_lq"><span class="header-section-number">1.13</span> polarization_lq</h3>
<p><em>Description</em>: Computes polarization index from parametric Lorenz fit</p>
<p><em>References</em>: </p>
<p><em>Relevant equations</em>: </p>
</section>
<section id="pip_stats_lb" class="level3" data-number="1.14">
<h3 data-number="1.14" class="anchored" data-anchor-id="pip_stats_lb"><span class="header-section-number">1.14</span> pip_stats_lb</h3>
<p><em>Description</em>: Compute poverty statistics for grouped data using the beta functional form of the Lorenz qurve.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>gd_compute_pip_stats_lb <span class="ot">&lt;-</span> <span class="cf">function</span>(welfare,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                    povline,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                    population,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                    requested_mean,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">popshare =</span> <span class="cn">NULL</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                    default_ppp,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">ppp =</span> <span class="cn">NULL</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">p0 =</span> <span class="fl">0.5</span>) {</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust mean if different PPP value is provided</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(ppp)) {</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    requested_mean <span class="ot">&lt;-</span> requested_mean <span class="sc">*</span> default_ppp <span class="sc">/</span> ppp</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    ppp <span class="ot">&lt;-</span> default_ppp</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STEP 1: Prep data to fit functional form</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  prepped_data <span class="ot">&lt;-</span> <span class="fu">create_functional_form_lb</span>(</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">welfare =</span> welfare,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> population</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STEP 2: Estimate regression coefficients using LB parameterization</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  reg_results <span class="ot">&lt;-</span> <span class="fu">regres</span>(prepped_data, <span class="at">is_lq =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  reg_coef <span class="ot">&lt;-</span> reg_results<span class="sc">$</span>coef</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> reg_coef[<span class="dv">1</span>]</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> reg_coef[<span class="dv">2</span>]</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> reg_coef[<span class="dv">3</span>]</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OPTIONAL: Only when popshare is supplied</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return poverty line if share of population living in poverty is supplied</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># instead of a poverty line</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(popshare)) {</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    povline <span class="ot">&lt;-</span> <span class="fu">derive_lb</span>(popshare, A, B, C) <span class="sc">*</span> requested_mean</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Boundary conditions (Why 4?)</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  z_min <span class="ot">&lt;-</span> requested_mean <span class="sc">*</span> <span class="fu">derive_lb</span>(<span class="fl">0.001</span>, A, B, C) <span class="sc">+</span> <span class="dv">4</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  z_max <span class="ot">&lt;-</span> requested_mean <span class="sc">*</span> <span class="fu">derive_lb</span>(<span class="fl">0.980</span>, A, B, C) <span class="sc">-</span> <span class="dv">4</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  z_min <span class="ot">&lt;-</span> <span class="cf">if</span> (z_min <span class="sc">&lt;</span> <span class="dv">0</span>) 0L <span class="cf">else</span> z_min</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  results1 <span class="ot">&lt;-</span> <span class="fu">list</span>(requested_mean, povline, z_min, z_max, ppp)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(results1) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"mean"</span>, <span class="st">"poverty_line"</span>, <span class="st">"z_min"</span>, <span class="st">"z_max"</span>, <span class="st">"ppp"</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STEP 3: Estimate poverty measures based on identified parameters</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>  results2 <span class="ot">&lt;-</span> <span class="fu">gd_estimate_lb</span>(requested_mean, povline, p0, A, B, C)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STEP 4: Compute measure of regression fit</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>  results_fit <span class="ot">&lt;-</span> <span class="fu">gd_compute_fit_lb</span>(welfare, population, results2<span class="sc">$</span>headcount, A, B, C)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">c</span>(results1, results2, results_fit, reg_results)</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="functional_form_lb" class="level3" data-number="1.15">
<h3 data-number="1.15" class="anchored" data-anchor-id="functional_form_lb"><span class="header-section-number">1.15</span> functional_form_lb</h3>
<p><em>Description</em>: Prepare data for Lorenz beta regression: <span class="math inline">\(Log(L(p) - p) = \log(a) + \alpha \log(p) + \beta \log(1 - p)\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>create_functional_form_lb <span class="ot">&lt;-</span> <span class="cf">function</span>(welfare, population) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CHECK inputs</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assertthat::assert_that(is.numeric(population))</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assertthat::assert_that(is.numeric(welfare))</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assertthat::assert_that(length(population) == length(welfare))</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assertthat::assert_that(length(population) &gt; 1)</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove last observation (the functional form for the Lorenz curve already forces</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># it to pass through the point (1, 1)</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  nobs <span class="ot">&lt;-</span> <span class="fu">length</span>(population) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  population <span class="ot">&lt;-</span> population[<span class="dv">1</span><span class="sc">:</span>nobs]</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  welfare <span class="ot">&lt;-</span> welfare[<span class="dv">1</span><span class="sc">:</span>nobs]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># y</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">log</span>(population <span class="sc">-</span> welfare)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x1</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> 1L</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x2</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> <span class="fu">log</span>(population)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x3</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  x3 <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> population)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">y =</span> y, <span class="at">X =</span> <span class="fu">cbind</span>(x1, x2, x3)))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em>: [5], [3]</p>
<p><em>Note</em>: The last observation of (p,l), which by construction has the value (1, 1), is excluded since the functional form for the Lorenz curve already forces it to pass through the point (1, 1).</p>
<p><em>Relevant equations</em>:</p>
<p>The general Beta Lorenz curve (Kakwani, 1980) form is: <span id="eq-beta-gen-equation"><span class="math display">\[ L(p) = p - a p^\alpha (1-p)^\beta \tag{5}\]</span></span></p>
<p>where <span class="math inline">\(L(p)\)</span> is the vector of cumulative proportion of consumption/income and <span class="math inline">\(p\)</span> is the cumulative proportions of population. They correspond to <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> in the Quadratic Lorenz form.</p>
<p>Note that in Datt (1998), the parameters have different letters: <span id="eq-beta-linear-form"><span class="math display">\[ L(p) = p - \theta p^\gamma (1-p)^\delta \tag{6}\]</span></span></p>
In our code, the parameters are addressed respectively as: $$
<span class="math display">\[\begin{aligned}
A = a = \theta \\

B = \alpha = \gamma \\

C = \beta = \delta
\end{aligned}\]</span>
<p>$$</p>
The previous equation is logged and rewritten as follows: $$
<span class="math display">\[\begin{aligned}
L(p) = p - a p^\alpha (1-p)^\beta \\

L(p) - p = - a p^\alpha (1-p)^\beta \\

p - L(p) = a p^\alpha (1-p)^\beta \\

Log(p - L(p)) =

\log(L(p) - p) = \log(a) + \alpha \log(p) + \beta \log(1 - p)

\end{aligned}\]</span>
<p>$$ ### value_at_lb <em>Description</em>: Solves for the Beta Lorenz curve.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>value_at_lb <span class="ot">&lt;-</span> <span class="cf">function</span>(x, A, B, C) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for NA, Inf and negative values in x</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_NA_Inf_values</span>(x)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_neg_values</span>(x)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> x <span class="sc">-</span> (A <span class="sc">*</span> (x<span class="sc">^</span>B) <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> x)<span class="sc">^</span>C))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em>: [5]</p>
<p>This function calculates the value at the Beta Lorenz Curve. It solves <a href="#eq-beta-gen-equation">Equation&nbsp;5</a> for <span class="math inline">\(L(p)\)</span>.</p>
</section>
<section id="derive_lb" class="level3" data-number="1.16">
<h3 data-number="1.16" class="anchored" data-anchor-id="derive_lb"><span class="header-section-number">1.16</span> derive_lb</h3>
<p><em>Description</em>: returns the first derivative of the Beta Lorenz curves.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>derive_lb <span class="ot">&lt;-</span> <span class="cf">function</span>(x, A, B, C) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="fu">length</span>(x))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  val[x <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  val[x <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (B <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      val[x <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> A</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (B <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      val[x <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (C <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>      val[x <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> A</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (C <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      val[x <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Formula for first derivative of GQ Lorenz Curve</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>      new_x <span class="ot">&lt;-</span> x[<span class="sc">!</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))]</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>      val[<span class="sc">!</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> ((A <span class="sc">*</span> new_x<span class="sc">^</span>B) <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> new_x)<span class="sc">^</span>C) <span class="sc">*</span> ((B <span class="sc">/</span> new_x) <span class="sc">-</span>( C <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> new_x)) ) )</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(val)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em>: [3]</p>
<p><em>Relevant equations</em>:</p>
As noted above, in our code, the parameters are addressed respectively as: $$
<span class="math display">\[\begin{aligned}
A = a = \theta \\

B = \alpha = \gamma \\

C = \beta = \delta
\end{aligned}\]</span>
<p>$$</p>
<p>Additionally, <span class="math inline">\(p = x\)</span> and <span class="math inline">\(L(p) = y\)</span>. We will use the code notation for practicality.</p>
<p>This function computes the first derivative of <a href="#eq-beta-gen-equation">Equation&nbsp;5</a>, which is derived as follows:</p>
<p><span class="math display">\[\begin{aligned}
y &amp;= x - A x^B (1-x)^C \\
y' &amp;= a A (1-x)^{C-1} x^B - AB(1-x)^C x^{B-1} + 1\\
&amp;= 1 - A (1-x)^C x^B \left[\frac{C}{1-x} - \frac{B}{x}\right]
\end{aligned}\]</span></p>
<div id="nte-lb-derivative" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Issues:
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are a series of boundary conditions for the first derivative, but I cannot find the reason for those boundary conditions in the literature. The conditions are the following:</p>
<ul>
<li>at <span class="math inline">\(x = 0\)</span>:
<ul>
<li>if <span class="math inline">\(B = 1\)</span> -&gt; <span class="math inline">\(1 - A\)</span></li>
<li>if <span class="math inline">\(B &gt; 1\)</span> -&gt; <span class="math inline">\(1\)</span></li>
</ul></li>
<li>at <span class="math inline">\(x = 1\)</span>:
<ul>
<li>if <span class="math inline">\(C = 1\)</span> -&gt; <span class="math inline">\(1 + A\)</span></li>
<li>if <span class="math inline">\(C &gt; 1\)</span> -&gt; <span class="math inline">\(1\)</span></li>
</ul></li>
</ul>
<p>According to Kakwani (1980) and the rest of the literature, the only condition for <span class="math inline">\(L'(x) = y'\)</span> is to be <span class="math inline">\(&gt;=0\)</span> at <span class="math inline">\(x = 0\)</span>. Now, if we follow the execution of the function, it is true that when <span class="math inline">\(x=0\)</span>, <span class="math inline">\(\frac{B}{X} = \frac{B}{0} = undefined\)</span>,which would cause calculation issues, but the rest of the derivative already sets <span class="math inline">\(L'(x) = 1\)</span>, so it is not clear to me why we have to set it to <span class="math inline">\(1-A\)</span> or <span class="math inline">\(1\)</span>. The same sort of reasoning applies at <span class="math inline">\(x = 1\)</span>, but with the parameter <span class="math inline">\(C\)</span>.</p>
</div>
</div>
</section>
<section id="estimate_lb" class="level3" data-number="1.17">
<h3 data-number="1.17" class="anchored" data-anchor-id="estimate_lb"><span class="header-section-number">1.17</span> estimate_lb</h3>
<p><em>Description</em>: Estimates poverty and inequality stats from the Beta Lorenz fit.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>gd_estimate_lb <span class="ot">&lt;-</span> <span class="cf">function</span>(mean, povline, p0, A, B, C) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute distributional measures</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  dist_stats <span class="ot">&lt;-</span> <span class="fu">gd_compute_dist_stats_lb</span>(mean, p0, A, B, C)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute poverty stats</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  pov_stats <span class="ot">&lt;-</span> <span class="fu">gd_compute_poverty_stats_lb</span>(mean, povline, A, B, C)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check validity</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  validity <span class="ot">&lt;-</span> <span class="fu">check_curve_validity_lb</span>(<span class="at">headcount =</span> pov_stats[[<span class="st">"headcount"</span>]], A, B, C)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">gini =</span> dist_stats<span class="sc">$</span>gini,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> dist_stats<span class="sc">$</span>median,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmhalf =</span> dist_stats<span class="sc">$</span>rmhalf,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">polarization =</span> dist_stats<span class="sc">$</span>polarization,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ris =</span> dist_stats<span class="sc">$</span>ris,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">mld =</span> dist_stats<span class="sc">$</span>mld,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">dcm =</span> dist_stats<span class="sc">$</span>dcm,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">deciles =</span> dist_stats<span class="sc">$</span>deciles,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">headcount =</span> pov_stats<span class="sc">$</span>headcount,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_gap =</span> pov_stats<span class="sc">$</span>pg,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_severity =</span> pov_stats<span class="sc">$</span>p2,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">eh =</span> pov_stats<span class="sc">$</span>eh,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">epg =</span> pov_stats<span class="sc">$</span>epg,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">ep =</span> pov_stats<span class="sc">$</span>ep,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">gh =</span> pov_stats<span class="sc">$</span>gh,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">gpg =</span> pov_stats<span class="sc">$</span>gpg,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">gp =</span> pov_stats<span class="sc">$</span>gp,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">watts =</span> pov_stats<span class="sc">$</span>watts,</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">dl =</span> pov_stats<span class="sc">$</span>dl,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">ddl =</span> pov_stats<span class="sc">$</span>ddl,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_normal =</span> validity<span class="sc">$</span>is_normal,</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid =</span> validity<span class="sc">$</span>is_valid</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="check_curve_validity_lb" class="level3" data-number="1.18">
<h3 data-number="1.18" class="anchored" data-anchor-id="check_curve_validity_lb"><span class="header-section-number">1.18</span> check_curve_validity_lb</h3>
<p><em>Description</em>: Check validity of Lorenz Beta fit:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>check_curve_validity_lb <span class="ot">&lt;-</span> <span class="cf">function</span>(headcount, A, B, C) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  is_valid <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (w <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.001</span>, <span class="at">to =</span> <span class="fl">0.1</span>, <span class="at">by =</span> <span class="fl">0.05</span>)) {</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">derive_lb</span>(w, A, B, C) <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>      is_valid <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (is_valid) {</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (w <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.001</span>, <span class="at">to =</span> <span class="fl">0.999</span>, <span class="at">by =</span> <span class="fl">0.05</span>)) {</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">DDLK</span>(w, A, B, C) <span class="sc">&lt;</span> <span class="dv">0</span>) { <span class="co"># What does DDLK stands for?? What does it do?</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        is_valid <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># WHAT IS THE RATIONAL HERE?</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  is_normal <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(headcount)) {</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    is_normal <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    is_normal <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid =</span> is_valid,</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_normal =</span> is_normal</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em>: [1], [3]</p>
<p>The function tests for specific assumptions for the Lorenz Beta and relies on the formulas from Table 2 in Datt, G (1998) [3].</p>
</section>
<section id="ddlk" class="level3" data-number="1.19">
<h3 data-number="1.19" class="anchored" data-anchor-id="ddlk"><span class="header-section-number">1.19</span> DDLK</h3>
<p><em>Description</em></p>
</section>
<section id="compute_poverty_stats_lb" class="level3" data-number="1.20">
<h3 data-number="1.20" class="anchored" data-anchor-id="compute_poverty_stats_lb"><span class="header-section-number">1.20</span> compute_poverty_stats_lb</h3>
<p><em>Description</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>gd_compute_poverty_stats_lb <span class="ot">&lt;-</span> <span class="cf">function</span>(mean,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                                        povline,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                                        A,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                        B,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                                        C) {</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute headcount</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  headcount <span class="ot">&lt;-</span> <span class="fu">gd_compute_headcount_lb</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> mean,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">povline =</span> povline,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">A =</span> A,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">B =</span> B,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">C =</span> C</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Poverty gap</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> mean <span class="sc">/</span> povline</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  pov_gap <span class="ot">&lt;-</span> <span class="fu">gd_compute_pov_gap_lb</span>(<span class="at">headcount =</span> headcount,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">A         =</span> A,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">B         =</span> B,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">C         =</span> C,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">u         =</span> u)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Poverty severity</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  pov_gap_sq <span class="ot">&lt;-</span> <span class="fu">gd_compute_pov_severity_lb</span>(</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">headcount =</span> headcount,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">pov_gap   =</span> pov_gap,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">A         =</span> A,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">B         =</span> B,</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">C         =</span> C,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">u         =</span> u</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First derivative of the Lorenz curve</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  dl <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> A <span class="sc">*</span> (headcount<span class="sc">^</span>B) <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> headcount)<span class="sc">^</span>C) <span class="sc">*</span> (B <span class="sc">/</span> headcount <span class="sc">-</span> C <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> headcount))</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Second derivative of the Lorenz curve</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  ddl <span class="ot">&lt;-</span> A <span class="sc">*</span> (headcount<span class="sc">^</span>B) <span class="sc">*</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">1</span> <span class="sc">-</span> headcount)<span class="sc">^</span>C) <span class="sc">*</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    ((B <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> B) <span class="sc">/</span> headcount<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">2</span> <span class="sc">*</span> B <span class="sc">*</span> C <span class="sc">/</span> (headcount <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> headcount))) <span class="sc">+</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>      (C <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> C) <span class="sc">/</span> ((<span class="dv">1</span> <span class="sc">-</span> headcount)<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Elasticity of headcount index w.r.t mean</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  eh <span class="ot">&lt;-</span> <span class="sc">-</span>povline <span class="sc">/</span> (mean <span class="sc">*</span> headcount <span class="sc">*</span> ddl)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Elasticity of poverty gap index w.r.t mean</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>  epg <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (headcount <span class="sc">/</span> pov_gap)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Elasticity of distributionally sensitive FGT poverty measure w.r.t mean</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>  ep <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> pov_gap <span class="sc">/</span> pov_gap_sq)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PElasticity of headcount index w.r.t gini index</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  gh <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> povline <span class="sc">/</span> mean) <span class="sc">/</span> (headcount <span class="sc">*</span> ddl)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Elasticity of poverty gap index w.r.t gini index</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>  gpg <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> (((mean <span class="sc">/</span> povline) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> headcount <span class="sc">/</span> pov_gap)</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Elasticity of distributionally sensitive FGT poverty measure w.r.t gini index</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>  gp <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (((mean <span class="sc">/</span> povline) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> pov_gap <span class="sc">/</span> pov_gap_sq))</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Watts index</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>  watts <span class="ot">&lt;-</span> <span class="fu">gd_compute_watts_lb</span>(headcount, mean, povline, <span class="fl">0.005</span>, A, B, C)</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">headcount =</span> headcount,</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">pg =</span> pov_gap,</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">p2 =</span> pov_gap_sq,</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">eh =</span> eh,</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">epg =</span> epg,</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">ep =</span> ep,</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">gh =</span> gh,</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">gpg =</span> gpg,</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">gp =</span> gp,</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">watts =</span> watts,</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">dl =</span> dl,</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">ddl =</span> ddl</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="compute_headcount_lb" class="level3" data-number="1.21">
<h3 data-number="1.21" class="anchored" data-anchor-id="compute_headcount_lb"><span class="header-section-number">1.21</span> compute_headcount_lb</h3>
<p><strong>Description</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>gd_compute_headcount_lb <span class="ot">&lt;-</span> <span class="cf">function</span>(mean, povline, A, B, C) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute headcount</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  headcount <span class="ot">&lt;-</span> <span class="fu">rtSafe</span>(<span class="fl">0.0001</span>, <span class="fl">0.9999</span>, <span class="fl">1e-4</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> mean,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">povline =</span> povline,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">A =</span> A,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">B =</span> B,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">C =</span> C</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check headcount invalidity conditions</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (headcount <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(headcount)) {</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  condition1 <span class="ot">&lt;-</span> <span class="fu">is.na</span>(<span class="fu">BETAI</span>(</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">a =</span> <span class="dv">2</span> <span class="sc">*</span> B <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">b =</span> <span class="dv">2</span> <span class="sc">*</span> C <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> headcount</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  condition2 <span class="ot">&lt;-</span> <span class="fu">is.na</span>(<span class="fu">BETAI</span>(</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">a =</span> <span class="dv">2</span> <span class="sc">*</span> B,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">b =</span> <span class="dv">2</span> <span class="sc">*</span> C,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> headcount</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  condition3 <span class="ot">&lt;-</span> <span class="fu">is.na</span>(<span class="fu">BETAI</span>(</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">a =</span> <span class="dv">2</span> <span class="sc">*</span> B <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">b =</span> <span class="dv">2</span> <span class="sc">*</span> C <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> headcount</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (condition1 <span class="sc">|</span> condition2 <span class="sc">|</span> condition3) {</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(headcount)</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="betai" class="level3" data-number="1.22">
<h3 data-number="1.22" class="anchored" data-anchor-id="betai"><span class="header-section-number">1.22</span> BETAI</h3>
<p><strong>Description</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>BETAI <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b, x) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(x)) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    bt <span class="ot">&lt;-</span> betai <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> x <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      bt <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>      bt <span class="ot">&lt;-</span> <span class="fu">exp</span>((a <span class="sc">*</span> <span class="fu">log</span>(x)) <span class="sc">+</span> (b <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> x)))</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x <span class="sc">&lt;</span> (a <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (a <span class="sc">+</span> b <span class="sc">+</span> <span class="dv">2</span>)) {</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>      betai <span class="ot">&lt;-</span> bt <span class="sc">*</span> <span class="fu">BETAICF</span>(a, b, x) <span class="sc">/</span> a</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">GAMMLN</span>(a)) <span class="sc">||</span> <span class="fu">is.na</span>(<span class="fu">GAMMLN</span>(b)) <span class="sc">||</span> <span class="fu">is.na</span>(<span class="fu">GAMMLN</span>(a <span class="sc">+</span> b))) {</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      betai <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>      betai <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">GAMMLN</span>(a) <span class="sc">+</span> <span class="fu">GAMMLN</span>(b) <span class="sc">-</span> <span class="fu">GAMMLN</span>(a <span class="sc">+</span> b)) <span class="sc">-</span> (bt <span class="sc">*</span> <span class="fu">BETAICF</span>(b, a, <span class="dv">1</span> <span class="sc">-</span> x) <span class="sc">/</span> b)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    betai <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(betai)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="betaicf" class="level3" data-number="1.23">
<h3 data-number="1.23" class="anchored" data-anchor-id="betaicf"><span class="header-section-number">1.23</span> BETAICF</h3>
<p><strong>Description</strong> This function uses the continued fraction method to calculate the Beta Incomplete function.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>BETAICF <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b, x) {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> <span class="fl">3e-7</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  am <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  bm <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  az <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  qab <span class="ot">&lt;-</span> a <span class="sc">+</span> b</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  qap <span class="ot">&lt;-</span> a <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  qam <span class="ot">&lt;-</span> a <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  bz <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">1</span> <span class="sc">-</span> (qab <span class="sc">*</span> x <span class="sc">/</span> qap), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">99</span>))</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  em <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  tem <span class="ot">&lt;-</span> em <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> em <span class="sc">*</span> (b <span class="sc">-</span> m) <span class="sc">*</span> x <span class="sc">/</span> ((qam <span class="sc">+</span> tem) <span class="sc">*</span> (a <span class="sc">+</span> tem))</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> <span class="sc">-</span>(a <span class="sc">+</span> em) <span class="sc">*</span> (qab <span class="sc">+</span> em) <span class="sc">*</span> x <span class="sc">/</span> ((a <span class="sc">+</span> tem) <span class="sc">*</span> (qap <span class="sc">+</span> tem))</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="dv">100</span>)) {</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    ap <span class="ot">&lt;-</span> az <span class="sc">+</span> (d[i] <span class="sc">*</span> am)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    bp <span class="ot">&lt;-</span> bz[i] <span class="sc">+</span> (d[i] <span class="sc">*</span> bm)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    app <span class="ot">&lt;-</span> ap <span class="sc">+</span> (d2[i]  <span class="sc">*</span> az)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    bpp <span class="ot">&lt;-</span> bp <span class="sc">+</span> (d2[i] <span class="sc">*</span> bz[i])</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    aold <span class="ot">&lt;-</span> az</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    am <span class="ot">&lt;-</span> ap <span class="sc">/</span> bpp</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    bm <span class="ot">&lt;-</span> bp <span class="sc">/</span> bpp</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    az <span class="ot">&lt;-</span> app <span class="sc">/</span> bpp</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((<span class="fu">abs</span>(az <span class="sc">-</span> aold)) <span class="sc">&lt;</span> (eps <span class="sc">*</span> <span class="fu">abs</span>(az))) {</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(az)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>References</em></p>
<p><em>Relevant equations</em>:</p>
</section>
<section id="gammln" class="level3" data-number="1.24">
<h3 data-number="1.24" class="anchored" data-anchor-id="gammln"><span class="header-section-number">1.24</span> GAMMLN</h3>
</section>
<section id="rtsafe" class="level3" data-number="1.25">
<h3 data-number="1.25" class="anchored" data-anchor-id="rtsafe"><span class="header-section-number">1.25</span> rtSafe</h3>
<p><em>Description</em>: <code>rtSafe</code>is an implementation of a safe version of <code>rtNewt</code>. It adds checks to ensure that the method is robust and converges correctly.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rtSafe <span class="ot">&lt;-</span> <span class="cf">function</span>(x1, x2, xacc, mean, povline, A, B, C) {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Evaluate the function at the initial guesses x1 and x2:</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  funcCall1 <span class="ot">&lt;-</span> <span class="fu">funcD</span>(x1, mean, povline, A, B, C)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  fl <span class="ot">&lt;-</span> funcCall1[[<span class="dv">1</span>]]  <span class="co"># Function value at x1 (low)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  funcCall2 <span class="ot">&lt;-</span> <span class="fu">funcD</span>(x2, mean, povline, A, B, C)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  fh <span class="ot">&lt;-</span> funcCall2[[<span class="dv">1</span>]]  <span class="co"># Function value at x2 (high)</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> funcCall2[[<span class="dv">2</span>]]  <span class="co"># Derivative value at x2</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the function values at x1 and x2 bracket a root (have opposite signs)</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (fl <span class="sc">*</span> fh <span class="sc">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If they do not bracket a root, fall back to the Newton-Raphson method (which has larger brackets)</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">rtNewt</span>(<span class="at">mean =</span> mean, <span class="at">povline =</span> povline, <span class="at">A =</span> A, <span class="at">B =</span> B, <span class="at">C =</span> C)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign xl and xh to bracket the root with xl having a function value less than 0</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (fl <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    xl <span class="ot">&lt;-</span> x1</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    xh <span class="ot">&lt;-</span> x2</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    xl <span class="ot">&lt;-</span> x2</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    xh <span class="ot">&lt;-</span> x1</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize the safe guess for the root as the midpoint between x1 and x2</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  rtsafe <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> (x1 <span class="sc">+</span> x2)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the full step and fractional step sizes to the interval length</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  dxold <span class="ot">&lt;-</span> <span class="fu">abs</span>(x2 <span class="sc">-</span> x1)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  dx <span class="ot">&lt;-</span> dxold</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Enter the main iteration loop</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="dv">99</span>)) {</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the function and derivative at the current guess rtsafe</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    funcCall3 <span class="ot">&lt;-</span> <span class="fu">funcD</span>(rtsafe, mean, povline, A, B, C)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> funcCall3[[<span class="dv">1</span>]]</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> funcCall3[[<span class="dv">2</span>]]</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for convergence by comparing the change in the root with the tolerance</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(<span class="dv">2</span> <span class="sc">*</span> f) <span class="sc">&gt;</span> <span class="fu">abs</span>(dxold <span class="sc">*</span> df)) {</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If not converging, bisect the interval</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>      dxold <span class="ot">&lt;-</span> dx</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>      dx <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> (xh <span class="sc">-</span> xl)</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>      rtsafe <span class="ot">&lt;-</span> xl <span class="sc">+</span> dx</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (xl <span class="sc">==</span> rtsafe) <span class="fu">return</span>(rtsafe)  <span class="co"># Check for underflow</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If converging, use Newton-Raphson step</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>      dxold <span class="ot">&lt;-</span> dx</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>      dx <span class="ot">&lt;-</span> f <span class="sc">/</span> df</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> rtsafe</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>      rtsafe <span class="ot">&lt;-</span> temp <span class="sc">-</span> dx</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (temp <span class="sc">==</span> rtsafe) <span class="fu">return</span>(rtsafe)  <span class="co"># Check for underflow</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the size of the Newton-Raphson step is less than the tolerance, return the root</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(dx) <span class="sc">&lt;</span> xacc) <span class="fu">return</span>(rtsafe)</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the function value at the new guess</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>    funcCall4 <span class="ot">&lt;-</span> <span class="fu">funcD</span>(rtsafe, mean, povline, A, B, C)</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> funcCall4[[<span class="dv">1</span>]]</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the interval bounds to continue the bisection process</span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (f <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>      xl <span class="ot">&lt;-</span> rtsafe</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>      xh <span class="ot">&lt;-</span> rtsafe</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If the loop finishes without returning, it indicates failure to converge</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Steps</em>:</p>
<ol type="1">
<li>Input parameters:</li>
</ol>
<ul>
<li><code>x1</code> and <code>x2</code>: initial guesses for the root, defining a bracket within which the root lies.</li>
<li><code>xacc</code>: desired accuracy for the root.</li>
<li><code>mean</code>, <code>povline</code>, and the parameters of the Lorenz curve.</li>
</ul>
<ol start="2" type="1">
<li>Initial Function Evaluation:
<ul>
<li>Calculate the function values at <code>x1</code> and <code>x2</code>.</li>
<li>If the function values at these points do not bracket a root (i.e., the function values are not of opposite signs), the function will revert to use <code>rtNewt</code> directly, using larger default bounds (0 and 1).</li>
</ul></li>
<li>Bracketing the Root:
<ul>
<li>Assign <code>xl</code> and <code>xh</code> to be the lower and upper bounds of the bracketing interval, respectively.</li>
<li>Ensure that the lower bound <code>xl</code> has a function value less than zero.</li>
<li><em>Note</em>: According to the Intermediate Value Theorem, if a continuous function changes sign over an interval, then there must be at least one root (zero crossing) within that interval. Therefore, bracketing is a way of confirming that within the interval <code>[xl, xh]</code> there is at least one root.</li>
</ul></li>
<li>Iterative Process:
<ul>
<li>Initialize the midpoint guess for the root, <code>rtsafe</code>, as halfway between <code>x1</code> and <code>x2</code>.</li>
<li>Set up variables <code>dxold</code> and <code>dx</code> to control the iteration step size.</li>
</ul></li>
<li>Main Iteration Loop:
<ul>
<li>For each iteration, calculate the function value and its derivative at <code>rtsafe</code>.</li>
<li>Use a combination of bisection and Newton-Raphson updates to adjust <code>rtsafe</code> and home in on the root.</li>
<li>If the function value at the new guess <code>rtsafe</code> is negative, update <code>xl</code>; otherwise, update <code>xh</code>.</li>
<li>Check for convergence by comparing the change in <code>rtsafe</code> with the tolerance <code>xacc</code>.</li>
<li>Repeat this process for a maximum of 99 iterations or until the root is found within the desired accuracy.</li>
</ul></li>
<li>Convergence Check:
<ul>
<li>If the algorithm converges to a root within the desired accuracy, the function returns the value of <code>rtsafe</code>.</li>
<li>If the function fails to converge within the set number of iterations, it returns <code>NA_real_</code> to indicate an unsuccessful search.</li>
</ul></li>
</ol>
</section>
<section id="funcd" class="level3" data-number="1.26">
<h3 data-number="1.26" class="anchored" data-anchor-id="funcd"><span class="header-section-number">1.26</span> funcD</h3>
<p><em>Description</em>: <code>funcD</code> returns two equations needed to calculate <span class="math inline">\(H\)</span> when using <span class="math display">\[L'(H) + \frac{z}{\mu} - 1 = 0\]</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>funcD <span class="ot">&lt;-</span> <span class="cf">function</span>(x, mean, povline, A, B, C) {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> x</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  v1 <span class="ot">&lt;-</span> (x<span class="sc">^</span>B) <span class="sc">*</span> (x1<span class="sc">^</span>C)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> (A <span class="sc">*</span> v1 <span class="sc">*</span> ((B <span class="sc">/</span> x) <span class="sc">-</span> (C <span class="sc">/</span> x1))) <span class="sc">+</span> (povline <span class="sc">/</span> mean) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> A <span class="sc">*</span> v1 <span class="sc">*</span> (((B <span class="sc">/</span> x) <span class="sc">-</span> (C <span class="sc">/</span> x1))<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> (B <span class="sc">/</span> x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">-</span> (C <span class="sc">/</span> x1<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">f =</span> f,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">df =</span> df</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Relevant Equations</em>:</p>
<ul>
<li><code>f</code> is equivalent to <span class="math inline">\(L'(H) + \frac{z}{\mu} - 1 = 0\)</span></li>
<li><code>df</code> is the derivative of <code>f</code>.</li>
</ul>
<p>See <code>rtNewt</code> for more details.</p>
</section>
<section id="rtnewt" class="level3" data-number="1.27">
<h3 data-number="1.27" class="anchored" data-anchor-id="rtnewt"><span class="header-section-number">1.27</span> rtNewt</h3>
<p><em>Description</em>: <code>rtNewt</code> uses the Newton-Raphson iteration to find <span class="math inline">\(H\)</span> (the headcount) using: <span class="math display">\[L'(H) + \frac{z}{\mu} - 1 = 0\]</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>rtNewt <span class="ot">&lt;-</span> <span class="cf">function</span>(mean, povline, A, B, C) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initial bounds of the search interval</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> 0L</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> 1L</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Accuracy tolerance for the solution</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  xacc <span class="ot">&lt;-</span> <span class="fl">1e-4</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initial guess for the root, halfway between x1 and x2</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  rtnewt <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> (x1 <span class="sc">+</span> x2)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform up to 19 iterations to find the root</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="dv">19</span>)) {</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Current guess for the proportion of the population</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> rtnewt</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Part of the Lorenz curve derivative: x^B * (1 - x)^C</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    v1 <span class="ot">&lt;-</span> (x<span class="sc">^</span>B) <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> x)<span class="sc">^</span>C)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The function whose root we're finding; it's the difference between the</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lorenz curve's derivative at x and the normalized poverty line</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> A <span class="sc">*</span> v1 <span class="sc">*</span> ((B <span class="sc">/</span> x) <span class="sc">-</span> (C <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x))) <span class="sc">+</span> (povline <span class="sc">/</span> mean) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Derivative of f with respect to x</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> A <span class="sc">*</span> v1 <span class="sc">*</span> (((B <span class="sc">/</span> x) <span class="sc">-</span> (C <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x)))<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> (B <span class="sc">/</span> x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">-</span> (C <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Newton-Raphson step size</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    dx <span class="ot">&lt;-</span> f <span class="sc">/</span> df</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the current guess for the root</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    rtnewt <span class="ot">&lt;-</span> rtnewt <span class="sc">-</span> dx</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the new guess is outside the initial interval</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((x1 <span class="sc">-</span> rtnewt) <span class="sc">*</span> (rtnewt <span class="sc">-</span> x2) <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Reset rtnewt to the midpoint of the interval closer to the bounds</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>      rtnewt <span class="ot">&lt;-</span> <span class="cf">if</span> (rtnewt <span class="sc">&lt;</span> x1) { <span class="fl">0.5</span> <span class="sc">*</span> (x2 <span class="sc">-</span> x) } <span class="cf">else</span> { <span class="fl">0.5</span> <span class="sc">*</span> (x <span class="sc">-</span> x1) }</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If the change in the root estimate is smaller than the tolerance, return it</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">abs</span>(dx) <span class="sc">&lt;</span> xacc) {</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(rtnewt)</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If no convergence, return NA to indicate failure</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Relevant equations</em>:</p>
<p>The first derivative of the Lorenz Beta curve evaluated at <span class="math inline">\(H\)</span> is equal to:</p>
$$
<span class="math display">\[\begin{aligned}
L'(H) = 1 - \frac{z}{\mu} \\
\theta H^\gamma (1-H)^\delta [\frac{\gamma}{H} - \frac{\delta}{1-H}] = 1 - \frac{z}{\mu}

\end{aligned}\]</span>
<p>$$</p>
<p>The Newton-Raphson iteration is used to find the root of an equation. In our case, this means finding when <span class="math inline">\(L'(H) = 0\)</span> or:</p>
<p><span class="math display">\[
\theta H^\gamma (1-H)^\delta [\frac{\gamma}{H} - \frac{\delta}{1-H}] + \frac{z}{\mu} - 1 = 0
\]</span></p>
<p><em>Steps:</em></p>
<ul>
<li>Initialize the algorithm:
<ul>
<li><code>x1</code> and <code>x2</code> are the initial boundaries of the search interval</li>
<li><code>xacc</code> is the accuracy tolerance for the solution</li>
<li><code>rtnewt</code> is the initial guess for the root, taken as the midpoint of the interval <code>[x1, x2]</code></li>
</ul></li>
<li>Begin the Iterative process:
<ul>
<li>Each iteration consists of:
<ul>
<li><code>v1</code> calculates a part of the function we need to solve for <span class="math inline">\(f(x) = L'(H)\)</span>, <span class="math inline">\(x^B (1-x)^C = H^\gamma (1-H)^\delta\)</span>.</li>
<li><code>f</code> sets up the function <span class="math inline">\(f(x) = L'(H)\)</span> as defined above.</li>
<li><code>df</code> sets up the derivative <span class="math inline">\(f'(x) = L''(H)\)</span>.</li>
</ul></li>
</ul></li>
<li>Update the Guess for the Root
<ul>
<li><code>dx</code> calculates the Newton-Raphson step size (<code>dx = f/df</code> = <span class="math inline">\(\frac{f(x_{old})}{f'(x_{old})}\)</span>)</li>
<li><code>rtnewt</code> updates the current guess by subtracting <code>dx</code> from it. This step is based on the Newton-Raphson update rule:</li>
</ul>
<span class="math display">\[x_{new} = x_{old} - \frac{f(x_{old})}{f'(x_{old})}\]</span></li>
<li>Check for interval boundaries and convergence: after each iteration, the algorithm checks whether the new guess <code>rtnewt</code> is within the initial interval <code>[x1, x2]</code>. If it is not, the interval is adjusted. If the guess is within the desired accuracy, the function returns the root <code>rtnewt</code>.</li>
</ul>
<p></p>
</section>
</section>
<section id="references" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="references"><span class="header-section-number">2</span> References</h2>
<ol type="1">
<li><p>Villasenor, J., B. C. Arnold. 1989. <a href="https://doi.org/10.1016/0304-4076(89)90089-4">Elliptical Lorenz curves</a>. <em>Journal of Econometrics 40</em> (2): 327-338.</p></li>
<li><p>Krause, M. 2013. <a href="https://doi.org/10.1016/j.jeconom.2013.01.001">Corrigendum to Elliptical Lorenz curves</a>. <em>Journal of Econometrics 174</em> (1): 44.</p></li>
<li><p>Datt, G. 1998. <a href="https://www.ifpri.org/publication/computational-tools-poverty-measurement-and-analysis">Computational Tools For Poverty Measurement And Analysis</a>. FCND Discussion Paper 50. World Bank, Washington, DC.</p></li>
<li><p>Rohde, N. (2008). <a href="https://doi.org/10.1007/978-0-387-72796-7_15">Lorenz Curves and Generalised Entropy Inequality Measures</a>. In: Chotikapanich, D. (eds) <em>Modeling Income Distributions and Lorenz Curves. Economic Studies in Equality, Social Exclusion and Well-Being</em>, vol 5. Springer, New York, NY.</p></li>
<li><p>Kakwani, N. 1980. <a href="https://EconPapers.repec.org/RePEc:ecm:emetrp:v:48:y:1980:i:2:p:437-46">On a Class of Poverty Measures</a>. <em>Econometrica 48</em> (2): 437-46.</p></li>
</ol>
</section>
<section id="appendix" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="appendix"><span class="header-section-number">3</span> Appendix</h2>
<p>Find function using the following list:</p>
<ul>
<li><a href="#sec-pip_stats">Section&nbsp;1.1</a>: <code>gd_compute_pip_stats</code></li>
<li><a href="#sec-select_lorenz">Section&nbsp;1.2</a>: <code>gd_select_lorenz</code></li>
<li><code>gd_compute_pip_stats_lq</code></li>
<li><code>gd_compute_pip_stats_lb</code></li>
<li><code>create_functional_form_lq</code></li>
<li><code>derive_lq</code></li>
<li><code>gd_estimate_lq</code></li>
<li><code>check_curve_validity_lq</code></li>
<li><code>gd_compute_dist_stats_lq</code></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>