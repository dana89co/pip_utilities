<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Diana Garcia">

<title>Group Data Documentation (wbpip)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="wbpip_gd_doc_files/libs/clipboard/clipboard.min.js"></script>
<script src="wbpip_gd_doc_files/libs/quarto-html/quarto.js"></script>
<script src="wbpip_gd_doc_files/libs/quarto-html/popper.min.js"></script>
<script src="wbpip_gd_doc_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="wbpip_gd_doc_files/libs/quarto-html/anchor.min.js"></script>
<link href="wbpip_gd_doc_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="wbpip_gd_doc_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="wbpip_gd_doc_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="wbpip_gd_doc_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="wbpip_gd_doc_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="wbpip_gd_doc_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="wbpip_gd_doc_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="wbpip_gd_doc_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#structure" id="toc-structure" class="nav-link active" data-scroll-target="#structure">Structure</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions"><span class="toc-section-number">1</span>  Functions</a>
  <ul class="collapse">
  <li><a href="#sec-pip_stats" id="toc-sec-pip_stats" class="nav-link" data-scroll-target="#sec-pip_stats"><span class="toc-section-number">1.1</span>  pip_stats</a></li>
  <li><a href="#sec-select_lorenz" id="toc-sec-select_lorenz" class="nav-link" data-scroll-target="#sec-select_lorenz"><span class="toc-section-number">1.2</span>  select_lorenz</a></li>
  <li><a href="#pip_stats_lq" id="toc-pip_stats_lq" class="nav-link" data-scroll-target="#pip_stats_lq"><span class="toc-section-number">1.3</span>  pip_stats_lq</a></li>
  <li><a href="#pip_stats_lb" id="toc-pip_stats_lb" class="nav-link" data-scroll-target="#pip_stats_lb"><span class="toc-section-number">1.4</span>  pip_stats_lb</a></li>
  <li><a href="#functional_form_lq" id="toc-functional_form_lq" class="nav-link" data-scroll-target="#functional_form_lq"><span class="toc-section-number">1.5</span>  functional_form_lq</a></li>
  <li><a href="#value_at_lq" id="toc-value_at_lq" class="nav-link" data-scroll-target="#value_at_lq"><span class="toc-section-number">1.6</span>  value_at_lq:</a></li>
  <li><a href="#derive_lq" id="toc-derive_lq" class="nav-link" data-scroll-target="#derive_lq"><span class="toc-section-number">1.7</span>  derive_lq</a></li>
  <li><a href="#estimate_lq" id="toc-estimate_lq" class="nav-link" data-scroll-target="#estimate_lq"><span class="toc-section-number">1.8</span>  estimate_lq</a></li>
  <li><a href="#check_curve_validity_lq" id="toc-check_curve_validity_lq" class="nav-link" data-scroll-target="#check_curve_validity_lq"><span class="toc-section-number">1.9</span>  check_curve_validity_lq</a></li>
  <li><a href="#compute_dist_stats_lq" id="toc-compute_dist_stats_lq" class="nav-link" data-scroll-target="#compute_dist_stats_lq"><span class="toc-section-number">1.10</span>  compute_dist_stats_lq</a></li>
  <li><a href="#quantile_lq" id="toc-quantile_lq" class="nav-link" data-scroll-target="#quantile_lq"><span class="toc-section-number">1.11</span>  quantile_lq</a></li>
  <li><a href="#mld_lq" id="toc-mld_lq" class="nav-link" data-scroll-target="#mld_lq"><span class="toc-section-number">1.12</span>  mld_lq</a></li>
  <li><a href="#gini_lq" id="toc-gini_lq" class="nav-link" data-scroll-target="#gini_lq"><span class="toc-section-number">1.13</span>  gini_lq</a></li>
  <li><a href="#polarization_lq" id="toc-polarization_lq" class="nav-link" data-scroll-target="#polarization_lq"><span class="toc-section-number">1.14</span>  polarization_lq</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="toc-section-number">2</span>  References:</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="toc-section-number">3</span>  Appendix:</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Group Data Documentation (wbpip)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Diana Garcia </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<h2 id="objective" class="unnumbered anchored">Objective</h2>
<p>This document aims to describe the functions used in <code>wbpip</code> to calculated the poverty and inequality statistics using group data.</p>
</blockquote>
<!-- I start by presenting the structure of the functions and then there is a description on how each function is built. -->
<section id="structure" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="structure">Structure</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid mermaid-js" data-tooltip-selector="#mermaid-tooltip-1">flowchart TD
    lz(select_lorenz) --&gt; stats[pip_stats]
    lq(pip_stats_lq) --&gt; lz
    lb(pip_stats_lb) --&gt; lz  
    form_lq(functional_form_lq) --&gt; lq
    derive_lq(derive_lq) --&gt; lq
    est_lq(estimate_lq) --&gt; lq
    check_val(check_curve_validity_lq) --&gt; est_lq
    comp_dist_lq(compute_dist_stats_lq) --&gt; est_lq
    polarization_lq(polarization_lq) --&gt; comp_dist_lq
    gini_lq(gini_lq) --&gt; comp_dist_lq
    value_at_lq --&gt; polarization_lq
    value_at_lq(value_at_lq) --&gt; comp_dist_lq
    mld_lq(mld_lq) --&gt; comp_dist_lq
    quantile_lq(quantile_lq) --&gt; comp_dist_lq
    derive_lq --&gt; comp_dist_lq
    derive_lq --&gt; mld_lq
    derive_lq --&gt; polarization_lq
    value_at_lq --&gt; quantile_lq

</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
</section>
<section id="functions" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="functions"><span class="header-section-number">1</span> Functions</h2>
<section id="sec-pip_stats" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="sec-pip_stats"><span class="header-section-number">1.1</span> pip_stats</h3>
<p><em>Description</em>: Compute poverty statistics for grouped data by selecting the best functional fit for the Lorenz curve (either beta or quadratic)</p>
<div id="nte-boundary-issue" class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Issue: Boundary conditions
</div>
</div>
<div id="nte-boundary-issue" class="callout-body-container callout-body">
<p>At the moment, this is calculated using <span class="math inline">\((\mu L'(0.001) + 4,\mu L'(0.98) - 4)\)</span> (<em>Note: Not sure what is the reason of adding and subtracting 4</em>).</p>
</div>
</div>
</section>
<section id="sec-select_lorenz" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="sec-select_lorenz"><span class="header-section-number">1.2</span> select_lorenz</h3>
<p><em>Description</em>: Select best Lorenz fit and adjust the returned statistics if needed.</p>
</section>
<section id="pip_stats_lq" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="pip_stats_lq"><span class="header-section-number">1.3</span> pip_stats_lq</h3>
<p><em>Description</em>: Compute poverty statistics for grouped data using the quadratic functional form of the Lorenz qurve.</p>
</section>
<section id="pip_stats_lb" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="pip_stats_lb"><span class="header-section-number">1.4</span> pip_stats_lb</h3>
<p><em>Description</em>: Compute poverty statistics for grouped data using the beta functional form of the Lorenz qurve.</p>
</section>
<section id="functional_form_lq" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="functional_form_lq"><span class="header-section-number">1.5</span> functional_form_lq</h3>
<p><em>Description</em>: Prepares data for regression of <span class="math inline">\(y(1-y)\)</span> on <span class="math inline">\((x^2-y)\)</span>, <span class="math inline">\(y(x-1)\)</span> and <span class="math inline">\((x-y)\)</span>.</p>
<p><em>Note</em>: The last observation of (x,y), which by construction has the value (1, 1), is excluded since the functional form for the Lorenz curve already forces it to pass through the point (1, 1).</p>
<p><em>References</em>: [1]</p>
<p><em>Relevant equations</em>:</p>
<p>The general Quadratic Lorenz curve form is:</p>
<p><span id="eq-gen-equation"><span class="math display">\[ax^2 + bxy + cy^2 + dx + ey + f = 0 \tag{1}\]</span></span></p>
<p>where <span class="math inline">\(y\)</span> is the vector of cumulative proportion of consumption/income (L) and <span class="math inline">\(x\)</span> is the cumulative proportions of population (P). Using the conditions <span class="math inline">\(f=0\)</span> and <span class="math inline">\(e = -(a+b+d+1)\)</span> the previous equation is rewritten in a linear form as follows (Equation 15 in Villasenor et al, 1989):</p>
<p><span id="eq-linear-form"><span class="math display">\[y(1-y) = a(x^2-y) + by(x-1) + d(x-y) \tag{2}\]</span></span></p>
<p>This function prepares data to estimate <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(d\)</span> (<em>Note</em>: <span class="math inline">\(d\)</span> is named <span class="math inline">\(C\)</span> in <code>wbpip</code>).</p>
</section>
<section id="value_at_lq" class="level3" data-number="1.6">
<h3 data-number="1.6" class="anchored" data-anchor-id="value_at_lq"><span class="header-section-number">1.6</span> value_at_lq:</h3>
<p><em>Description</em>: Solves for the Quadratic Lorenz curves.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>value_at_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(x, A, B, C, key_values) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for NA, Inf and negative values in x</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_NA_Inf_values</span>(x)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_neg_values</span>(x)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculations</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e &lt;- -(A + B + C + 1)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># m &lt;- (B^2) - (4 * A)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n &lt;- (2 * B * e) - (4 * C)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> (key_values<span class="sc">$</span>m <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (key_values<span class="sc">$</span>n <span class="sc">*</span> x) <span class="sc">+</span> (key_values<span class="sc">$</span>e<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  temp[temp <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Solving the equation of the Lorenz curve</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  estle <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> ((B <span class="sc">*</span> x) <span class="sc">+</span> key_values<span class="sc">$</span>e <span class="sc">+</span> <span class="fu">sqrt</span>(temp))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(estle)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>References</em>: [1]</p>
<p><em>Relevant equations</em>:</p>
<p>This function calculates the value at the Quadratic Lorenz Curve. Solving <a href="#eq-gen-equation">Equation&nbsp;1</a> for <span class="math inline">\(y\)</span>, and assuming <span class="math inline">\(f=0\)</span> and <span class="math inline">\(e = -(a+b+d+1)\)</span> the density function that better fits income distributions will be (Equation 6b in Villasenor et al, 1989):</p>
<p><span id="eq-solve-y"><span class="math display">\[ y= \Bigl\{-(bx+e) - (\alpha x^2 + \beta x + e^2)^\frac{1}{2}\Bigl\}/2 \tag{3}\]</span></span></p>
<p>where <span class="math inline">\(\alpha = b^2 -4a\)</span> and <span class="math inline">\(\beta = 2be - 4d\)</span>.</p>
</section>
<section id="derive_lq" class="level3" data-number="1.7">
<h3 data-number="1.7" class="anchored" data-anchor-id="derive_lq"><span class="header-section-number">1.7</span> derive_lq</h3>
<p><em>Description</em>: returns the first derivative of the quadratic Lorenz curves with <span class="math inline">\(c = 1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>derive_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(x, A, B, C, key_values) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(key_values)) {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    key_values <span class="ot">&lt;-</span> <span class="fu">gd_lq_key_values</span>(A, B, C)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># e          &lt;- key_values$e</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># m          &lt;- key_values$m</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># n          &lt;- key_values$n</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">anyNA</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    cli<span class="sc">::</span><span class="fu">cli_abort</span>(<span class="st">"`x' must be a numeric or integer vector"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note:</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   alpha --&gt; m</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   beta  --&gt; n</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e &lt;- -(A + B + C + 1)</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># m &lt;- (B^2) - (4 * A)</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n &lt;- (2 * B * e) - (4 * C) # C is called D in original paper, but C in Datt paper</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> (key_values<span class="sc">$</span>m <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (key_values<span class="sc">$</span>n <span class="sc">*</span> x) <span class="sc">+</span> (key_values<span class="sc">$</span>e<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  tmp[(<span class="sc">!</span><span class="fu">is.na</span>(tmp) <span class="sc">&amp;</span> tmp <span class="sc">&lt;</span> <span class="dv">0</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># If tmp == 0, val = Inf.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Formula for first derivative of GQ Lorenz Curve</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;-</span> <span class="sc">-</span>(B <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> ((<span class="dv">2</span> <span class="sc">*</span> key_values<span class="sc">$</span>m <span class="sc">*</span> x <span class="sc">+</span> key_values<span class="sc">$</span>n) <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> <span class="fu">sqrt</span>(tmp)))</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(val)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>References</em>: [1]</p>
<p><em>Relevant equations</em>:</p>
<p>This function computes the first derivative of <a href="#eq-solve-y">Equation&nbsp;3</a>:</p>
<p><span id="eq-first-der"><span class="math display">\[-(b / 2) - (\beta + 2 \alpha x) / (4\sqrt(\alpha x^2 + \beta x + e^2) \tag{4}\]</span></span></p>
</section>
<section id="estimate_lq" class="level3" data-number="1.8">
<h3 data-number="1.8" class="anchored" data-anchor-id="estimate_lq"><span class="header-section-number">1.8</span> estimate_lq</h3>
<p><em>Description</em>: Estimates poverty and inequality stats from Quadratic Lorenz fit</p>
</section>
<section id="check_curve_validity_lq" class="level3" data-number="1.9">
<h3 data-number="1.9" class="anchored" data-anchor-id="check_curve_validity_lq"><span class="header-section-number">1.9</span> check_curve_validity_lq</h3>
<p><em>Description</em>: Check validity of Lorenz Quadratic fit</p>
<p><em>References</em>: [1], [2], [3]</p>
<p><em>Relevant equations</em>:</p>
<p>The function tests for specific assumptions for the Lorenz Quadratic and relies on the formulas from Table 2 in Datt, G (1998) [3]. The nomenclature for some of these formulas differ from Villasenor et al (1989), so this is how they match:</p>
<p><span class="math inline">\(m = \alpha = b^2 -4a\)</span></p>
<p><span class="math inline">\(n = \beta = 2be -4c\)</span> (<span class="math inline">\(c=d\)</span> for Villasenor et al, 1989)</p>
<p><span class="math inline">\(r = K*2\alpha = (n^2 - 4me^2)^\frac{1}{2}\)</span></p>
<div id="nte-cond-r-issue" class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Issue: Rename <span class="math inline">\(r\)</span>
</div>
</div>
<div id="nte-cond-r-issue" class="callout-body-container callout-body">
<p>At the moment, <span class="math inline">\(r\)</span> refers to <span class="math inline">\((n^2 - 4me^2)\)</span> in <code>wbpip</code>. This is already fixed on commit <code>47852c</code> in branch <code>fix_key_values</code> by Zander (Waiting for merge). We should maybe rename this within this function.</p>
</div>
</div>
<p>The conditions this function tests are presented in Section 4 of Datt (1998):</p>
<p>Normality and Validity</p>
<ul>
<li><span class="math inline">\((n^2 - 4me^2)&gt;0\)</span> so the square root in <span class="math inline">\(r\)</span> to be positive. (Normality and validity)</li>
<li><span class="math inline">\(e&lt;0\)</span> or <span class="math inline">\(c&gt;0\)</span> so <span class="math inline">\(L(0,y) = 0\)</span> and <span class="math inline">\(L'(0^{+},y) \geq 0\)</span> (Normality and validity)</li>
<li><span class="math inline">\(a+d \geq 0.9\)</span> so <span class="math inline">\(L(1,y) = 1\)</span> (Validity)</li>
</ul>
<div id="imp-condad" class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Issue: The inequality for <span class="math inline">\(a+d\)</span>
</div>
</div>
<div id="imp-condad" class="callout-body-container callout-body">
<p>At the moment, we still use the old validation <span class="math inline">\(a+d \leq 1\)</span>. However, the Corrigendum of the original paper [2] indicates we should use <span class="math inline">\(a+d \geq 1\)</span></p>
</div>
</div>
<p>And so <span class="math inline">\(L''(x,y) \geq 0\)</span> for <span class="math inline">\(x\)</span> within <span class="math inline">\((0,1)\)</span>:</p>
<ul>
<li><span class="math inline">\(m &lt; 0\)</span> (condition on Villasenor et al., 1989)</li>
<li>if <span class="math inline">\(m &gt; 0\)</span> then <span class="math inline">\(m &lt; n^2/4 e^2\)</span> and <span class="math inline">\(n \leq 0\)</span> (last condition from Datt,1998)</li>
<li>if <span class="math inline">\(m &gt; 0\)</span> then <span class="math inline">\(m &lt; n^2/4 e^2\)</span> and <span class="math inline">\(m &lt; -n/2\)</span> (last condition from Datt,1998)</li>
</ul>
<p><span class="math inline">\(L''(x,y)\)</span> can be calculated using <a href="#eq-first-der">Equation&nbsp;4</a>:</p>
<p><span class="math display">\[ \frac{\beta^2 -4\alpha e^2}{8(\alpha x^2 + \beta x + e^2)^\frac{3}{2}} = \frac{n^2 - 4me^2}{8(mx^2 +nx +e^2)^\frac{3}{2}}=\frac{r^2}{8(mx^2 +nx +e^2)^\frac{3}{2}} \]</span></p>
</section>
<section id="compute_dist_stats_lq" class="level3" data-number="1.10">
<h3 data-number="1.10" class="anchored" data-anchor-id="compute_dist_stats_lq"><span class="header-section-number">1.10</span> compute_dist_stats_lq</h3>
<p><em>Description</em>: Computes distributional stats from Lorenz Quadratic fit</p>
<div id="nte-check1" class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Check:
</div>
</div>
<div id="nte-check1" class="callout-body-container callout-body">
<p>What is the difference with <code>gd_estimate_dist_stats_lq</code>?</p>
</div>
</div>
</section>
<section id="quantile_lq" class="level3" data-number="1.11">
<h3 data-number="1.11" class="anchored" data-anchor-id="quantile_lq"><span class="header-section-number">1.11</span> quantile_lq</h3>
<p><em>Description</em>: Compute quantiles from Lorenz Quandratic fit</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>old_gd_compute_quantile_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C, <span class="at">n_quantile =</span> <span class="dv">10</span>) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> n_quantile)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> n_quantile</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> 0L</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  lastq <span class="ot">&lt;-</span> 0L</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n_quantile <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    q <span class="ot">&lt;-</span> <span class="fu">value_at_lq</span>(x1, A, B, C)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">&lt;-</span> q <span class="sc">-</span> lastq</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    vec[i] <span class="ot">&lt;-</span> v</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    lastq <span class="ot">&lt;-</span> q</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    x1 <span class="ot">&lt;-</span> x1 <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> n_quantile</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  vec[n_quantile] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> lastq</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vec)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Note</em>: This function calculates the quantiles for a Lorenz Quadratic with specific values for <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span> and <span class="math inline">\(d\)</span>.</p>
<div id="imp-quant-gd-issue" class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Issues:
</div>
</div>
<div id="imp-quant-gd-issue" class="callout-body-container callout-body">
<p>The description of this function indicates that it calculates the quantiles (deciles) for the density for some specific values of <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span> and <span class="math inline">\(d\)</span>, but it calculates instead the “share” or the value between the deciles. If I understand correctly, the density is the lorenz curve and the share will refer to the <code>deciles</code> of the welfare vector.</p>
<p>Regarding the last decile, they manually calculated it by subtracting 1 to the second-to-last decile:</p>
<p><code>vec[n_quantile] &lt;- 1 - value_at_lq(x[n_quantile-1], A, B, C)</code> where <code>n_quantile = 10</code></p>
<p>However, my hypothesis is that this is related to <em>Issue: The inequality for <span class="math inline">\(a+d\)</span></em> above. If <span class="math inline">\(A+C \geq 1\)</span> then <code>value_at_lq(1, A, B, C) = 1</code></p>
</div>
</div>
<p><em>My version of the code</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>gd_compute_quantile_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C, <span class="at">n_quantile =</span> <span class="dv">10</span>) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  x   <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span><span class="sc">/</span>n_quantile, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span><span class="sc">/</span>n_quantile)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">value_at_lq</span>(x, A, B, C)))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  vec[n_quantile] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> <span class="fu">value_at_lq</span>(x[n_quantile<span class="dv">-1</span>], A, B, C) <span class="co"># Is this correct?</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vec)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mld_lq" class="level3" data-number="1.12">
<h3 data-number="1.12" class="anchored" data-anchor-id="mld_lq"><span class="header-section-number">1.12</span> mld_lq</h3>
<p><em>Description</em>: Computes Mean Log Deviation from Lorenz Quadratic fit</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>old_gd_compute_mld_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(<span class="fl">0.0005</span>, A, B, C)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  gap <span class="ot">&lt;-</span> 0L</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  mld <span class="ot">&lt;-</span> 0L</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x1 <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    gap <span class="ot">&lt;-</span> <span class="fl">0.0005</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    mld <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">log</span>(x1) <span class="sc">*</span> <span class="fl">0.001</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(<span class="dv">0</span>, A, B, C)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (xstep <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.998</span>, <span class="fl">0.001</span>)) {</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    x2 <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(xstep <span class="sc">+</span> <span class="fl">0.001</span>, A, B, C)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((x1 <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="sc">||</span> (x2 <span class="sc">&lt;=</span> <span class="dv">0</span>)) {</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      gap <span class="ot">&lt;-</span> gap <span class="sc">+</span> <span class="fl">0.001</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (gap <span class="sc">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      gap <span class="ot">&lt;-</span> 0L</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>      mld <span class="ot">&lt;-</span> mld <span class="sc">+</span> (<span class="fu">log</span>(x1) <span class="sc">+</span> <span class="fu">log</span>(x2)) <span class="sc">*</span> <span class="fl">0.0005</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    x1 <span class="ot">&lt;-</span> x2</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span>mld)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>References</em>: None</p>
<p><em>Note</em>: In this function, they do not describe how the function is calculated. The following is my hypothesis of what they were trying to accomplish:</p>
<p><em>Relevant equations</em>:</p>
<p>The mean log deviation:</p>
<p><span class="math display">\[-\frac{1}{N} \sum_{i=1}^N ln(\frac{y_i}{\mu})=-\frac{1}{N} \sum_{i=1}^N ln(\frac{y_i}{\frac{1}{N}\sum_{i=1}^N y_i}) \]</span></p>
<p>Using the derivation from Rohde (2008) (Equation 15.20), we know that:</p>
<p><span class="math display">\[L'(\pi) = \frac{N y_k}{\sum_{k=1}^N y_k}\]</span></p>
<p>where <span class="math inline">\(y_k\)</span> is the income accruing to the <span class="math inline">\(k_{th}\)</span> individual if ordered such that <span class="math inline">\(y_1&lt;y_2&lt;...&lt;y_k\)</span> and <span class="math inline">\(\pi= \frac{k}{j}\)</span>. Then the mean log deviation can be rewritten as (Equation 15.21):</p>
<p><span class="math display">\[-\int_0^1 ln(L'(\pi))d\pi= \lim_{n \rightarrow \infty} -\sum_{i=1}^{N}\frac{1}{N}ln(\frac{N y_k}{\sum_{k=1}^N y_k})\]</span></p>
<div id="imp-mld-gd-issue" class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Issue:
</div>
</div>
<div id="imp-mld-gd-issue" class="callout-body-container callout-body">
<p>My hypothesis is that they used the last formula to calculate the Mean Log Deviation. I am still unsure why they used some rules at the lower end, more specifically why they return <span class="math inline">\(1\)</span> if for the left tail of <span class="math inline">\(y\)</span> we encounter negative values.</p>
</div>
</div>
<p><em>My version of the code</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>gd_compute_mld_lq <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, C) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(<span class="fl">0.0005</span>, A, B, C) <span class="co"># Not sure I understand this condition</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#gap &lt;- 0L</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  mld <span class="ot">&lt;-</span> 0L</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x1 <span class="sc">==</span> <span class="dv">0</span>) { <span class="co"># So log is not undefined</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#gap &lt;- 0.0005</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    mld <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">log</span>(x1) <span class="sc">*</span> <span class="fl">0.001</span>) <span class="co"># Needed to match test</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  xstep <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.999</span>, <span class="fl">0.001</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">derive_lq</span>(xstep, A, B, C)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">33</span>]<span class="sc">&lt;=</span><span class="dv">0</span>)){ <span class="co"># To account for the gap and the stop parameter within the loop.</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    mld <span class="ot">&lt;-</span> mld <span class="sc">+</span> <span class="fu">fsum</span>( (<span class="fu">log</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])<span class="sc">+</span><span class="fu">log</span>(x[<span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>])) <span class="sc">*</span><span class="fl">0.0005</span>) <span class="co"># Not sure why add previous mld</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="sc">-</span>mld)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x1 &lt;- derive_lq(0, A, B, C)</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for (xstep in seq(0, 0.998, 0.001)) {</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   x2 &lt;- derive_lq(xstep + 0.001, A, B, C)</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   if ((x1 &lt;= 0) || (x2 &lt;= 0)) {</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     gap &lt;- gap + 0.001</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     if (gap &gt; 0.5) {</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       return(-1)</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     }</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   } else {</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     gap &lt;- 0L</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     mld &lt;- mld + (log(x1) + log(x2)) * 0.0005</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   }</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   x1 &lt;- x2</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gini_lq" class="level3" data-number="1.13">
<h3 data-number="1.13" class="anchored" data-anchor-id="gini_lq"><span class="header-section-number">1.13</span> gini_lq</h3>
<p><em>Description</em>: Compute Gini index from Lorenz Quadratic fit.</p>
<p><em>References</em>: [3]</p>
<p><em>Relevant equations</em>: …</p>
</section>
<section id="polarization_lq" class="level3" data-number="1.14">
<h3 data-number="1.14" class="anchored" data-anchor-id="polarization_lq"><span class="header-section-number">1.14</span> polarization_lq</h3>
<p><em>Description</em>: Computes polarization index from parametric Lorenz fit</p>
<p><em>References</em>: …</p>
<p><em>Relevant equations</em>: …</p>
</section>
</section>
<section id="references" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="references"><span class="header-section-number">2</span> References:</h2>
<ol type="1">
<li><p>Villasenor, J., B. C. Arnold. 1989. “<a href="https://doi.org/10.1016/0304-4076(89)90089-4">Elliptical Lorenz curves</a>”. <em>Journal of Econometrics 40</em> (2): 327-338.</p></li>
<li><p>Krause, M. 2013. “<a href="https://doi.org/10.1016/j.jeconom.2013.01.001">Corrigendum to Elliptical Lorenz curves</a>”. <em>Journal of Econometrics 174</em> (1): 44.</p></li>
<li><p>Datt, G. 1998. “<a href="https://www.ifpri.org/cdmref/p15738coll2/id/125673">Computational Tools For Poverty Measurement And Analysis</a>”. FCND Discussion Paper 50. World Bank, Washington, DC.</p></li>
<li><p>Rohde, N. (2008). “<a href="https://doi.org/10.1007/978-0-387-72796-7_15">Lorenz Curves and Generalised Entropy Inequality Measures</a>”. In: Chotikapanich, D. (eds) <em>Modeling Income Distributions and Lorenz Curves. Economic Studies in Equality, Social Exclusion and Well-Being</em>, vol 5. Springer, New York, NY.</p></li>
</ol>
</section>
<section id="appendix" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="appendix"><span class="header-section-number">3</span> Appendix:</h2>
<p>Find function using the following list:</p>
<ul>
<li><a href="#sec-pip_stats">Section&nbsp;1.1</a>: <code>gd_compute_pip_stats</code></li>
<li><a href="#sec-select_lorenz">Section&nbsp;1.2</a>: <code>gd_select_lorenz</code></li>
<li><code>gd_compute_pip_stats_lq</code></li>
<li><code>gd_compute_pip_stats_lb</code></li>
<li><code>create_functional_form_lq</code></li>
<li><code>derive_lq</code></li>
<li><code>gd_estimate_lq</code></li>
<li><code>check_curve_validity_lq</code></li>
<li><code>gd_compute_dist_stats_lq</code></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>